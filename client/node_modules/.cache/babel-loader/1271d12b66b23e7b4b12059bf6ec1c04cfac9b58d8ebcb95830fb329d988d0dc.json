{"ast":null,"code":"var _jsxFileName = \"/home/cristian/Documentos/7mo/lenguajes_programacion/Videoconferencia-app/client/src/pages/Room.js\",\n  _s = $RefreshSig$();\nimport React, { useEffect, useRef, useState } from \"react\";\nimport { useParams } from \"react-router-dom\";\nimport Peer from \"simple-peer\";\nimport io from \"socket.io-client\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst socket = io.connect(\"http://localhost:5000\");\nfunction Room() {\n  _s();\n  const {\n    roomId\n  } = useParams();\n  const [stream, setStream] = useState(null);\n  const myVideo = useRef();\n  const userVideo = useRef();\n  const connectionRef = useRef();\n  useEffect(() => {\n    // 1. Get User Media\n    navigator.mediaDevices.getUserMedia({\n      video: true,\n      audio: true\n    }).then(currentStream => {\n      setStream(currentStream);\n      if (myVideo.current) {\n        myVideo.current.srcObject = currentStream;\n      }\n\n      // 2. Join the room via socket\n      socket.emit(\"join-room\", roomId);\n\n      // 3. Setup Socket Listeners\n\n      // Case A: We are the 'Host' (already in room), and a new user joined.\n      // We initiate the call.\n      socket.on(\"user-joined\", userId => {\n        console.log(\"User joined:\", userId, \"- Initiating call\");\n        const peer = new Peer({\n          initiator: true,\n          trickle: false,\n          stream: currentStream\n        });\n        peer.on(\"signal\", data => {\n          socket.emit(\"signal\", {\n            roomId,\n            data\n          });\n        });\n        peer.on(\"stream\", remoteStream => {\n          if (userVideo.current) {\n            userVideo.current.srcObject = remoteStream;\n          }\n        });\n        connectionRef.current = peer;\n      });\n\n      // Case B: We receive a signal (Offer or Answer)\n      socket.on(\"signal\", data => {\n        console.log(\"Received signal data\");\n\n        // If we are already connected/connecting (Host receiving Answer)\n        if (connectionRef.current) {\n          connectionRef.current.signal(data);\n        }\n        // If we are the 'Guest' (receiving Offer for first time)\n        else {\n          console.log(\"Answering call\");\n          const peer = new Peer({\n            initiator: false,\n            trickle: false,\n            stream: currentStream\n          });\n          peer.on(\"signal\", signalData => {\n            socket.emit(\"signal\", {\n              roomId,\n              data: signalData\n            });\n          });\n          peer.on(\"stream\", remoteStream => {\n            if (userVideo.current) {\n              userVideo.current.srcObject = remoteStream;\n            }\n          });\n          peer.signal(data);\n          connectionRef.current = peer;\n        }\n      });\n    }).catch(err => {\n      console.error(\"Error accessing media devices:\", err);\n    });\n    return () => {\n      socket.off(\"user-joined\");\n      socket.off(\"signal\");\n      if (connectionRef.current) {\n        connectionRef.current.destroy();\n      }\n    };\n  }, [roomId]);\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    style: {\n      textAlign: \"center\",\n      padding: \"20px\"\n    },\n    children: [/*#__PURE__*/_jsxDEV(\"h2\", {\n      children: [\"Sala de Videoconferencia: \", roomId]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 99,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      style: {\n        display: \"flex\",\n        justifyContent: \"center\",\n        gap: \"20px\",\n        flexWrap: \"wrap\"\n      },\n      children: [/*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"video-card\",\n        children: [/*#__PURE__*/_jsxDEV(\"h3\", {\n          children: \"Tu Video\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 102,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"video\", {\n          playsInline: true,\n          muted: true,\n          ref: myVideo,\n          autoPlay: true,\n          style: {\n            width: \"400px\",\n            borderRadius: \"10px\",\n            backgroundColor: \"#000\"\n          }\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 104,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 101,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"video-card\",\n        children: [/*#__PURE__*/_jsxDEV(\"h3\", {\n          children: \"Video Remoto\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 107,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"video\", {\n          playsInline: true,\n          ref: userVideo,\n          autoPlay: true,\n          style: {\n            width: \"400px\",\n            borderRadius: \"10px\",\n            backgroundColor: \"#000\"\n          }\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 108,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 106,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 100,\n      columnNumber: 7\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 98,\n    columnNumber: 5\n  }, this);\n}\n_s(Room, \"EHSLV4BUCb4I8Co7RUEmFebpPps=\", false, function () {\n  return [useParams];\n});\n_c = Room;\nexport default Room;\nvar _c;\n$RefreshReg$(_c, \"Room\");","map":{"version":3,"names":["React","useEffect","useRef","useState","useParams","Peer","io","jsxDEV","_jsxDEV","socket","connect","Room","_s","roomId","stream","setStream","myVideo","userVideo","connectionRef","navigator","mediaDevices","getUserMedia","video","audio","then","currentStream","current","srcObject","emit","on","userId","console","log","peer","initiator","trickle","data","remoteStream","signal","signalData","catch","err","error","off","destroy","style","textAlign","padding","children","fileName","_jsxFileName","lineNumber","columnNumber","display","justifyContent","gap","flexWrap","className","playsInline","muted","ref","autoPlay","width","borderRadius","backgroundColor","_c","$RefreshReg$"],"sources":["/home/cristian/Documentos/7mo/lenguajes_programacion/Videoconferencia-app/client/src/pages/Room.js"],"sourcesContent":["import React, { useEffect, useRef, useState } from \"react\";\nimport { useParams } from \"react-router-dom\";\nimport Peer from \"simple-peer\";\nimport io from \"socket.io-client\";\n\nconst socket = io.connect(\"http://localhost:5000\");\n\nfunction Room() {\n  const { roomId } = useParams();\n  const [stream, setStream] = useState(null);\n  const myVideo = useRef();\n  const userVideo = useRef();\n  const connectionRef = useRef();\n\n  useEffect(() => {\n    // 1. Get User Media\n    navigator.mediaDevices.getUserMedia({ video: true, audio: true })\n      .then((currentStream) => {\n        setStream(currentStream);\n        if (myVideo.current) {\n          myVideo.current.srcObject = currentStream;\n        }\n\n        // 2. Join the room via socket\n        socket.emit(\"join-room\", roomId);\n\n        // 3. Setup Socket Listeners\n\n        // Case A: We are the 'Host' (already in room), and a new user joined.\n        // We initiate the call.\n        socket.on(\"user-joined\", (userId) => {\n          console.log(\"User joined:\", userId, \"- Initiating call\");\n          const peer = new Peer({\n            initiator: true,\n            trickle: false,\n            stream: currentStream\n          });\n\n          peer.on(\"signal\", (data) => {\n            socket.emit(\"signal\", { roomId, data });\n          });\n\n          peer.on(\"stream\", (remoteStream) => {\n            if (userVideo.current) {\n              userVideo.current.srcObject = remoteStream;\n            }\n          });\n\n          connectionRef.current = peer;\n        });\n\n        // Case B: We receive a signal (Offer or Answer)\n        socket.on(\"signal\", (data) => {\n          console.log(\"Received signal data\");\n\n          // If we are already connected/connecting (Host receiving Answer)\n          if (connectionRef.current) {\n            connectionRef.current.signal(data);\n          }\n          // If we are the 'Guest' (receiving Offer for first time)\n          else {\n            console.log(\"Answering call\");\n            const peer = new Peer({\n              initiator: false,\n              trickle: false,\n              stream: currentStream\n            });\n\n            peer.on(\"signal\", (signalData) => {\n              socket.emit(\"signal\", { roomId, data: signalData });\n            });\n\n            peer.on(\"stream\", (remoteStream) => {\n              if (userVideo.current) {\n                userVideo.current.srcObject = remoteStream;\n              }\n            });\n\n            peer.signal(data);\n            connectionRef.current = peer;\n          }\n        });\n      })\n      .catch(err => {\n        console.error(\"Error accessing media devices:\", err);\n      });\n\n    return () => {\n      socket.off(\"user-joined\");\n      socket.off(\"signal\");\n      if (connectionRef.current) {\n        connectionRef.current.destroy();\n      }\n    };\n  }, [roomId]);\n\n  return (\n    <div style={{ textAlign: \"center\", padding: \"20px\" }}>\n      <h2>Sala de Videoconferencia: {roomId}</h2>\n      <div style={{ display: \"flex\", justifyContent: \"center\", gap: \"20px\", flexWrap: \"wrap\" }}>\n        <div className=\"video-card\">\n          <h3>Tu Video</h3>\n          {/* Muted to avoid feedback loop */}\n          <video playsInline muted ref={myVideo} autoPlay style={{ width: \"400px\", borderRadius: \"10px\", backgroundColor: \"#000\" }} />\n        </div>\n        <div className=\"video-card\">\n          <h3>Video Remoto</h3>\n          <video playsInline ref={userVideo} autoPlay style={{ width: \"400px\", borderRadius: \"10px\", backgroundColor: \"#000\" }} />\n        </div>\n      </div>\n    </div>\n  );\n}\n\nexport default Room;\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}