{"ast":null,"code":"var _jsxFileName = \"/home/cristian/Documentos/7mo/lenguajes_programacion/Videoconferencia-app/client/src/pages/Room.js\",\n  _s = $RefreshSig$(),\n  _s2 = $RefreshSig$();\nimport React, { useEffect, useRef, useState } from \"react\";\nimport { useParams, useNavigate } from \"react-router-dom\";\nimport Peer from \"simple-peer\";\nimport io from \"socket.io-client\";\nimport { useAuth } from \"../context/AuthContext\";\nimport { useAudioLevel } from \"../hooks/useAudioLevel\";\nimport axios from \"axios\";\nimport PdfViewer from \"../components/PdfViewer\";\nimport GroupManager from \"../components/GroupManager\";\n\n// WebRTC Configuration\nimport { jsxDEV as _jsxDEV, Fragment as _Fragment } from \"react/jsx-dev-runtime\";\nconst peerConfig = {\n  iceServers: [{\n    urls: 'stun:stun.l.google.com:19302'\n  }, {\n    urls: 'stun:global.stun.twilio.com:3478'\n  }]\n};\nconst API_URL = window.location.origin + '/api';\nfunction Room() {\n  _s();\n  var _user$nombre;\n  const {\n    roomId\n  } = useParams();\n  const {\n    user\n  } = useAuth();\n  const navigate = useNavigate();\n\n  // Media streams\n  const [myStream, setMyStream] = useState(null);\n  const [peers, setPeers] = useState([]);\n  const [participants, setParticipants] = useState([]);\n  const [screenStream, setScreenStream] = useState(null);\n\n  // UI state\n  const [audioEnabled, setAudioEnabled] = useState(true);\n  const [videoEnabled, setVideoEnabled] = useState(true);\n  const [showChat, setShowChat] = useState(true);\n  const [showPdf, setShowPdf] = useState(false);\n\n  // Chat\n  const [messages, setMessages] = useState([]);\n  const [newMessage, setNewMessage] = useState(\"\");\n\n  // PDF\n  const [pdfState, setPdfState] = useState(null);\n  const [uploadingPdf, setUploadingPdf] = useState(false);\n  const [whiteboardData, setWhiteboardData] = useState({}); // { 1: [lines], 2: [lines] ... }\n  const [currentPage, setCurrentPage] = useState(1);\n  const [activeTool, setActiveTool] = useState(\"pen\"); // pen, eraser // Array of lines\n\n  // Groups\n  const [groups, setGroups] = useState([]);\n\n  // Active speakers\n  const [activeSpeakers, setActiveSpeakers] = useState(new Set());\n\n  // Refs\n  const myVideo = useRef();\n  const socketRef = useRef();\n  const streamRef = useRef();\n  const peersRef = useRef([]);\n  const chatEndRef = useRef();\n  const fileInputRef = useRef();\n  const iceCandidatesQueue = useRef({}); // Buffer for out-of-order candidates\n\n  const host = window.location.hostname;\n  const API_URL = '/api';\n\n  // Detect if I'm speaking\n  const isSpeaking = useAudioLevel(myStream);\n  useEffect(() => {\n    if (isSpeaking) {\n      var _socketRef$current;\n      (_socketRef$current = socketRef.current) === null || _socketRef$current === void 0 ? void 0 : _socketRef$current.emit(\"user-speaking\", {\n        roomId,\n        userId: user.id,\n        userName: user.nombre\n      });\n    } else {\n      var _socketRef$current2;\n      (_socketRef$current2 = socketRef.current) === null || _socketRef$current2 === void 0 ? void 0 : _socketRef$current2.emit(\"user-stopped-speaking\", {\n        roomId,\n        userId: user.id\n      });\n    }\n  }, [isSpeaking]);\n  useEffect(() => {\n    // Check if mediaDevices is available (requires HTTPS or localhost)\n    if (!navigator.mediaDevices || !navigator.mediaDevices.getUserMedia) {\n      alert(\"âš ï¸ WebRTC no estÃ¡ disponible.\\n\\n\" + \"Para usar video/audio, debes acceder desde:\\n\" + \"â€¢ http://localhost:3000 (en este equipo)\\n\" + \"â€¢ https://... (conexiÃ³n segura)\\n\\n\" + \"Actualmente estÃ¡s en: \" + window.location.href + \"\\n\\n\" + \"El chat y PDF funcionarÃ¡n, pero no el video.\");\n      // Continue without video/audio\n      socketRef.current = io.connect(window.location.origin);\n      const socket = socketRef.current;\n      socket.emit(\"join-room\", {\n        roomId,\n        userId: user.id,\n        userName: user.nombre\n      });\n      loadChatHistory();\n      return;\n    }\n\n    // Initialize socket\n    socketRef.current = io.connect(window.location.origin);\n    const socket = socketRef.current;\n\n    // Get user media\n    navigator.mediaDevices.getUserMedia({\n      video: true,\n      audio: true\n    }).then(currentStream => {\n      setMyStream(currentStream);\n      // Save stream to ref for access in event listeners\n      streamRef.current = currentStream;\n      if (myVideo.current) {\n        myVideo.current.srcObject = currentStream;\n      }\n\n      // Join room\n      socket.emit(\"join-room\", {\n        roomId,\n        userId: user.id || user._id,\n        // Handle fallback\n        userName: user.nombre\n      });\n\n      // Load chat history\n      loadChatHistory();\n    }).catch(err => {\n      console.error(\"Error accessing media devices:\", err);\n      alert(\"No se pudo acceder a la cÃ¡mara o micrÃ³fono.\\n\\n\" + \"Posibles causas:\\n\" + \"â€¢ Permisos denegados\\n\" + \"â€¢ CÃ¡mara/micrÃ³fono en uso por otra app\\n\" + \"â€¢ Dispositivos no disponibles\\n\\n\" + \"El chat y PDF funcionarÃ¡n normalmente.\");\n\n      // Continue without video/audio\n      socket.emit(\"join-room\", {\n        roomId,\n        userId: user.id || user._id,\n        // Handle fallback\n        userName: user.nombre\n      });\n      loadChatHistory();\n    });\n\n    // Socket event listeners\n    socket.on(\"room-participants\", users => {\n      console.log(\"Current participants payload:\", JSON.stringify(users, null, 2));\n      setParticipants(users);\n\n      // Create peers for existing participants\n      users.forEach(participant => {\n        if (participant.socketId !== socket.id && participant.socketId) {\n          // Use stream from ref to ensure we have latest stream\n          createPeer(participant.socketId, socket.id, streamRef.current);\n        }\n      });\n    });\n    socket.on(\"user-joined\", ({\n      userId: newUserId,\n      userName,\n      participants: newParticipants\n    }) => {\n      console.log(`User joined event: ${userName}, ID: ${newUserId}`);\n      console.log(\"Full participants list updated:\", JSON.stringify(newParticipants, null, 2));\n      setParticipants(newParticipants);\n      // The new user will initiate the connection\n    });\n    socket.on(\"offer\", ({\n      offer,\n      from\n    }) => {\n      console.log(\"Received signal (offer/candidate) from:\", from);\n      const existingPeer = peersRef.current.find(p => p.peerID === from);\n      if (existingPeer) {\n        // If peer exists, just signal it (for trickle ICE candidates)\n        existingPeer.peer.signal(offer);\n        return;\n      }\n\n      // Use stream from ref\n      if (streamRef.current) {\n        const peer = addPeer(offer, from, streamRef.current);\n        peersRef.current.push({\n          peerID: from,\n          peer\n        });\n        setPeers([...peersRef.current]);\n\n        // Process any queued candidates for this peer\n        if (iceCandidatesQueue.current[from]) {\n          console.log(`Processing ${iceCandidatesQueue.current[from].length} queued candidates for ${from}`);\n          iceCandidatesQueue.current[from].forEach(candidate => {\n            peer.signal(candidate);\n          });\n          delete iceCandidatesQueue.current[from];\n        }\n      } else {\n        console.warn(\"Cannot accept offer, no stream available\");\n      }\n    });\n    socket.on(\"answer\", ({\n      answer,\n      from\n    }) => {\n      const item = peersRef.current.find(p => p.peerID === from);\n      if (item) {\n        item.peer.signal(answer);\n      }\n    });\n    socket.on(\"ice-candidate\", ({\n      candidate,\n      from\n    }) => {\n      const item = peersRef.current.find(p => p.peerID === from);\n      if (item) {\n        item.peer.signal(candidate);\n      } else {\n        // Queue the candidate if peer not ready yet\n        console.log(`Queueing candidate for unknown peer ${from}`);\n        if (!iceCandidatesQueue.current[from]) {\n          iceCandidatesQueue.current[from] = [];\n        }\n        iceCandidatesQueue.current[from].push(candidate);\n      }\n    });\n    socket.on(\"user-left\", ({\n      socketId,\n      participants: newParticipants\n    }) => {\n      const peerObj = peersRef.current.find(p => p.peerID === socketId);\n      if (peerObj) {\n        peerObj.peer.destroy();\n      }\n      peersRef.current = peersRef.current.filter(p => p.peerID !== socketId);\n      setPeers([...peersRef.current]);\n      setParticipants(newParticipants);\n      setActiveSpeakers(prev => {\n        const newSet = new Set(prev);\n        newSet.delete(socketId);\n        return newSet;\n      });\n    });\n\n    // Chat events\n    socket.on(\"receive-message\", message => {\n      setMessages(prev => [...prev, message]);\n      setTimeout(() => {\n        var _chatEndRef$current;\n        return (_chatEndRef$current = chatEndRef.current) === null || _chatEndRef$current === void 0 ? void 0 : _chatEndRef$current.scrollIntoView({\n          behavior: \"smooth\"\n        });\n      }, 100);\n    });\n\n    // PDF events\n    socket.on(\"pdf-state\", pdfData => {\n      console.log(\"Room.js: Received pdf-state:\", pdfData);\n      setPdfState(pdfData);\n      setShowPdf(true); // Auto-show on new PDF\n    });\n    socket.on(\"pdf-page-update\", ({\n      currentPage\n    }) => {\n      setPdfState(prev => prev ? {\n        ...prev,\n        currentPage\n      } : null);\n    });\n    socket.on(\"pdf-removed\", () => {\n      setPdfState(null);\n      setShowPdf(false);\n      setWhiteboardData({});\n    });\n    socket.on(\"pdf-presenters-update\", ({\n      presenters\n    }) => {\n      setPdfState(prev => prev ? {\n        ...prev,\n        presenters\n      } : null);\n    });\n    socket.on(\"whiteboard-draw\", ({\n      line,\n      page\n    }) => {\n      // line includes { points, color, width }\n      setWhiteboardData(prev => {\n        const pageLines = prev[page] || [];\n        return {\n          ...prev,\n          [page]: [...pageLines, line]\n        };\n      });\n    });\n    socket.on(\"whiteboard-clear\", ({\n      page\n    }) => {\n      setWhiteboardData(prev => ({\n        ...prev,\n        [page]: []\n      }));\n    });\n\n    // Group events\n    socket.on(\"groups-update\", updatedGroups => {\n      setGroups(updatedGroups);\n    });\n    socket.on(\"error-permission\", ({\n      message\n    }) => {\n      alert(message);\n    });\n\n    // Active speaker events\n    socket.on(\"user-speaking\", ({\n      socketId\n    }) => {\n      setActiveSpeakers(prev => new Set(prev).add(socketId));\n    });\n    socket.on(\"user-stopped-speaking\", ({\n      socketId\n    }) => {\n      setActiveSpeakers(prev => {\n        const newSet = new Set(prev);\n        newSet.delete(socketId);\n        return newSet;\n      });\n    });\n\n    // Screen sharing events\n    socket.on(\"screen-share-active\", ({\n      socketId\n    }) => {\n      console.log(\"Screen share started by:\", socketId);\n    });\n    socket.on(\"screen-share-ended\", () => {\n      console.log(\"Screen share ended\");\n    });\n\n    // Cleanup\n    return () => {\n      if (myStream) {\n        myStream.getTracks().forEach(track => track.stop());\n      }\n      if (screenStream) {\n        screenStream.getTracks().forEach(track => track.stop());\n      }\n      peersRef.current.forEach(({\n        peer\n      }) => peer.destroy());\n      socket.disconnect();\n    };\n  }, [roomId]);\n  function createPeer(userToSignal, callerID, stream) {\n    const peer = new Peer({\n      initiator: true,\n      stream,\n      config: peerConfig\n    });\n    peer.on(\"signal\", signal => {\n      console.log(\"Generating signal (initiator):\", signal.type, \"for\", userToSignal);\n      if (signal.type === 'offer') {\n        socketRef.current.emit(\"offer\", {\n          roomId,\n          offer: signal,\n          to: userToSignal\n        });\n      } else if (signal.candidate || signal.type === 'candidate') {\n        socketRef.current.emit(\"ice-candidate\", {\n          roomId,\n          candidate: signal,\n          to: userToSignal\n        });\n      }\n    });\n    peer.on(\"connect\", () => {\n      console.log(\"Peer Connection Established with:\", userToSignal);\n    });\n\n    // Add to peers ref immediately\n    peersRef.current.push({\n      peerID: userToSignal,\n      peer\n    });\n    setPeers([...peersRef.current]);\n    return peer;\n  }\n  function addPeer(incomingSignal, callerID, stream) {\n    const peer = new Peer({\n      initiator: false,\n      stream,\n      config: peerConfig\n    });\n    peer.on(\"signal\", signal => {\n      console.log(\"Generating signal (receiver):\", signal.type, \"for\", callerID);\n      if (signal.type === 'answer') {\n        socketRef.current.emit(\"answer\", {\n          roomId,\n          answer: signal,\n          to: callerID\n        });\n      } else if (signal.candidate || signal.type === 'candidate') {\n        socketRef.current.emit(\"ice-candidate\", {\n          roomId,\n          candidate: signal,\n          to: callerID\n        });\n      }\n    });\n    peer.on(\"connect\", () => {\n      console.log(\"Peer Connection Established with:\", callerID);\n    });\n    peer.signal(incomingSignal);\n    return peer;\n  }\n  const loadChatHistory = async () => {\n    try {\n      const response = await axios.get(`${API_URL}/chat/${roomId}`);\n      setMessages(response.data.messages);\n      setTimeout(() => {\n        var _chatEndRef$current2;\n        return (_chatEndRef$current2 = chatEndRef.current) === null || _chatEndRef$current2 === void 0 ? void 0 : _chatEndRef$current2.scrollIntoView();\n      }, 100);\n    } catch (error) {\n      console.error(\"Error loading chat:\", error);\n    }\n  };\n  const sendMessage = e => {\n    e.preventDefault();\n    if (newMessage.trim()) {\n      const messageData = {\n        roomId,\n        userId: user.id || user._id,\n        userName: user.nombre,\n        texto: newMessage,\n        timestamp: new Date()\n      };\n      socketRef.current.emit(\"send-message\", messageData);\n      setNewMessage(\"\");\n    }\n  };\n  const toggleAudio = () => {\n    if (myStream) {\n      const audioTrack = myStream.getAudioTracks()[0];\n      audioTrack.enabled = !audioTrack.enabled;\n      setAudioEnabled(audioTrack.enabled);\n      socketRef.current.emit(\"toggle-audio\", {\n        roomId,\n        userId: user.id || user._id,\n        audioEnabled: audioTrack.enabled\n      });\n    }\n  };\n  const toggleVideo = () => {\n    if (myStream) {\n      const videoTrack = myStream.getVideoTracks()[0];\n      videoTrack.enabled = !videoTrack.enabled;\n      setVideoEnabled(videoTrack.enabled);\n      socketRef.current.emit(\"toggle-video\", {\n        roomId,\n        userId: user.id || user._id,\n        videoEnabled: videoTrack.enabled\n      });\n    }\n  };\n  const handlePdfUpload = async e => {\n    const file = e.target.files[0];\n    if (!file || file.type !== \"application/pdf\") {\n      alert(\"Por favor selecciona un archivo PDF\");\n      return;\n    }\n    setUploadingPdf(true);\n    const formData = new FormData();\n    formData.append(\"pdf\", file);\n    formData.append(\"totalPages\", \"1\");\n    try {\n      // NOTE: With pdfjs-dist on client, we could count pages first then upload.\n      // But for now, let's keep simplistic upload. \n      // The backend should ideally count pages, but pdfjs needs binary there.\n      // Let's stick to uploading, receiving state, then viewer renders.\n      // But wait! Page 1/1 bug was due to not knowing totalPages.\n      // Frontend PdfViewer will determine totalPages now.\n\n      const token = localStorage.getItem(\"token\");\n      if (!token) {\n        alert(\"No hay sesiÃ³n activa\");\n        return;\n      }\n      const response = await axios.post(`${API_URL}/pdf/upload/${roomId}`, formData, {\n        headers: {\n          \"Content-Type\": \"multipart/form-data\",\n          \"Authorization\": `Bearer ${token}`\n        }\n      });\n      const pdfData = response.data.pdf;\n      // Socket event is emitted by server as 'pdf-state' or we emit 'pdf-uploaded'? \n      // Current pattern: Server receives upload -> updates DB -> emits 'pdf-state' ??\n      // Let's check server...\n      // Server DOES NOT emit 'pdf-state' automatically in upload route.\n      // Server waits for 'pdf-uploaded' socket event from client.\n\n      socketRef.current.emit(\"pdf-uploaded\", {\n        roomId,\n        pdfData\n      });\n      // Don't set state immediately, wait for socket ack to be in sync? \n      // Or set local optimizingly.\n      setPdfState(pdfData);\n      setShowPdf(true);\n    } catch (error) {\n      console.error(\"Error uploading PDF:\", error);\n      alert(\"Error al subir PDF\");\n    } finally {\n      setUploadingPdf(false);\n    }\n  };\n\n  /* \n   * NEW: Check if I am a presenter \n   */\n  const amIPresenter = () => {\n    // If Group Linked, check group membership\n    if (pdfState && pdfState.linkedGroupId) {\n      const group = groups.find(g => g._id === pdfState.linkedGroupId);\n      if (group) {\n        const myId = user.id || user._id;\n        return group.members.includes(myId);\n      }\n    }\n    if (!pdfState || !pdfState.presenters) return false;\n    const myId = user.id || user._id; // Robust ID check\n    return pdfState.presenters.includes(myId);\n  };\n  const amIOwner = () => {\n    if (!pdfState) return false;\n    const myId = user.id || user._id;\n    // Robust check: compare as strings\n    const ownerId = pdfState.ownerId || pdfState.uploadedBy;\n    if (!ownerId) return false;\n    return String(ownerId) === String(myId);\n  };\n  const changePdfPage = direction => {\n    if (!pdfState) return;\n    if (!amIPresenter()) return; // Permissions check\n\n    let newPage = pdfState.currentPage + direction;\n    if (newPage < 1) newPage = 1;\n    if (newPage > pdfState.totalPages) newPage = pdfState.totalPages;\n    socketRef.current.emit(\"pdf-page-changed\", {\n      roomId,\n      currentPage: newPage,\n      userId: user.id || user._id\n    });\n    // Optimistic update\n    setPdfState({\n      ...pdfState,\n      currentPage: newPage\n    });\n  };\n  const handleWhiteboardDraw = line => {\n    // line is { points: [x1, y1, x2, y2], color, ... }\n    const fileOwnerId = user.id || user._id;\n    const page = pdfState ? pdfState.currentPage : 1;\n\n    // Add page info to line if needed by components, but mainly for storage\n    const lineWithTool = {\n      ...line,\n      tool: activeTool\n    };\n    socketRef.current.emit(\"whiteboard-draw\", {\n      roomId,\n      line: lineWithTool,\n      userId: fileOwnerId,\n      page\n    });\n    setWhiteboardData(prev => {\n      const pageLines = prev[page] || [];\n      return {\n        ...prev,\n        [page]: [...pageLines, lineWithTool]\n      };\n    });\n  };\n  const handleClearWhiteboard = () => {\n    const page = pdfState ? pdfState.currentPage : 1;\n    socketRef.current.emit(\"whiteboard-clear\", {\n      roomId,\n      page\n    });\n    setWhiteboardData(prev => ({\n      ...prev,\n      [page]: []\n    }));\n  };\n  const grantPresenter = targetId => {\n    socketRef.current.emit(\"pdf-grant-presenter\", {\n      roomId,\n      targetUserId: targetId\n    });\n  };\n  const revokePresenter = targetId => {\n    socketRef.current.emit(\"pdf-revoke-presenter\", {\n      roomId,\n      targetUserId: targetId\n    });\n  };\n\n  // Helper handling PDF page load to update total pages if needed (fix 1/1 bug)\n  const onPdfLoadSuccess = numPages => {\n    if (pdfState && pdfState.totalPages !== numPages) {\n      setPdfState(prev => ({\n        ...prev,\n        totalPages: numPages\n      }));\n      // Sync with server\n      socketRef.current.emit(\"pdf-update-metadata\", {\n        roomId,\n        totalPages: numPages\n      });\n    }\n  };\n  const shareScreen = async () => {\n    if (!navigator.mediaDevices || !navigator.mediaDevices.getDisplayMedia) {\n      alert(\"Compartir pantalla requiere HTTPS o localhost\");\n      return;\n    }\n    try {\n      const screenStream = await navigator.mediaDevices.getDisplayMedia({\n        video: true,\n        audio: false\n      });\n      setScreenStream(screenStream);\n      const screenTrack = screenStream.getVideoTracks()[0];\n\n      // Replace video track for all peers\n      peersRef.current.forEach(({\n        peer\n      }) => {\n        // Find the video track in the current sender\n        const sender = peer._pc.getSenders().find(s => s.track.kind === 'video');\n        if (sender) {\n          sender.replaceTrack(screenTrack);\n        }\n      });\n\n      // Notify server\n      socketRef.current.emit(\"screen-share-started\", {\n        roomId,\n        userId: user.id\n      });\n\n      // Update local video to show screen share verify it works\n      if (myVideo.current) {\n        myVideo.current.srcObject = screenStream;\n      }\n      screenTrack.onended = () => {\n        stopScreenShare();\n      };\n    } catch (error) {\n      console.error(\"Error sharing screen:\", error);\n      if (error.name === 'NotAllowedError') {\n        // User cancelled\n      } else {\n        alert(\"Error al compartir pantalla: \" + error.message);\n      }\n    }\n  };\n  const stopScreenShare = () => {\n    if (screenStream) {\n      screenStream.getTracks().forEach(track => track.stop());\n      setScreenStream(null);\n\n      // Revert to camera track\n      if (streamRef.current) {\n        const videoTrack = streamRef.current.getVideoTracks()[0];\n        peersRef.current.forEach(({\n          peer\n        }) => {\n          const sender = peer._pc.getSenders().find(s => s.track.kind === 'video');\n          if (sender) {\n            sender.replaceTrack(videoTrack);\n          }\n        });\n\n        // Restore local video\n        if (myVideo.current) {\n          myVideo.current.srcObject = streamRef.current;\n        }\n      }\n      socketRef.current.emit(\"screen-share-stopped\", {\n        roomId\n      });\n    }\n  };\n  const leaveRoom = () => {\n    if (myStream) {\n      myStream.getTracks().forEach(track => track.stop());\n    }\n    navigate(\"/\");\n  };\n  const shouldShowControls = amIPresenter();\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    style: {\n      display: \"flex\",\n      height: \"100vh\",\n      background: \"var(--bg-primary)\"\n    },\n    children: [/*#__PURE__*/_jsxDEV(\"div\", {\n      style: {\n        flex: 1,\n        display: \"flex\",\n        flexDirection: \"column\",\n        padding: \"20px\",\n        overflow: \"hidden\"\n      },\n      children: [/*#__PURE__*/_jsxDEV(\"div\", {\n        style: {\n          marginBottom: \"20px\",\n          display: \"flex\",\n          justifyContent: \"space-between\",\n          alignItems: \"center\"\n        },\n        children: [/*#__PURE__*/_jsxDEV(\"h2\", {\n          style: {\n            color: \"var(--text-secondary)\",\n            margin: 0\n          },\n          children: [\"Sala: \", /*#__PURE__*/_jsxDEV(\"span\", {\n            style: {\n              color: \"var(--accent-primary)\"\n            },\n            children: roomId\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 687,\n            columnNumber: 19\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 686,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          style: {\n            display: \"flex\",\n            gap: \"10px\"\n          },\n          children: [/*#__PURE__*/_jsxDEV(\"button\", {\n            onClick: () => setShowChat(!showChat),\n            className: \"btn\",\n            style: {\n              padding: \"8px 16px\",\n              fontSize: \"0.9rem\"\n            },\n            children: [showChat ? \"Ocultar\" : \"Mostrar\", \" Chat\"]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 690,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(GroupManager, {\n            roomId: roomId,\n            socket: socketRef.current,\n            groups: groups,\n            user: user,\n            currentPdf: pdfState\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 697,\n            columnNumber: 13\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 689,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 685,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        style: {\n          flex: 1,\n          display: \"flex\",\n          gap: \"20px\",\n          overflow: \"hidden\"\n        },\n        children: [showPdf && pdfState && (pdfState.isPresenting || amIPresenter()) ? /*#__PURE__*/_jsxDEV(\"div\", {\n          style: {\n            flex: 3,\n            display: \"flex\",\n            flexDirection: \"column\",\n            background: \"#2a2a2a\",\n            borderRadius: \"12px\",\n            overflow: \"hidden\"\n          },\n          children: [/*#__PURE__*/_jsxDEV(\"div\", {\n            style: {\n              padding: \"10px\",\n              background: \"rgba(0,0,0,0.3)\",\n              display: \"flex\",\n              justifyContent: \"space-between\",\n              alignItems: \"center\"\n            },\n            children: [/*#__PURE__*/_jsxDEV(\"div\", {\n              style: {\n                display: \"flex\",\n                gap: \"10px\",\n                alignItems: \"center\"\n              },\n              children: [/*#__PURE__*/_jsxDEV(\"button\", {\n                onClick: () => changePdfPage(-1),\n                disabled: pdfState.currentPage <= 1 || !amIPresenter(),\n                className: \"btn\",\n                style: {\n                  padding: \"5px 10px\",\n                  opacity: amIPresenter() ? 1 : 0.5\n                },\n                children: \"\\u2190\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 731,\n                columnNumber: 19\n              }, this), /*#__PURE__*/_jsxDEV(\"span\", {\n                style: {\n                  color: \"white\"\n                },\n                children: [pdfState.currentPage, \" / \", pdfState.totalPages || \"--\"]\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 739,\n                columnNumber: 19\n              }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n                onClick: () => changePdfPage(1),\n                disabled: pdfState.currentPage >= pdfState.totalPages || !amIPresenter(),\n                className: \"btn\",\n                style: {\n                  padding: \"5px 10px\",\n                  opacity: amIPresenter() ? 1 : 0.5\n                },\n                children: \"\\u2192\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 742,\n                columnNumber: 19\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 730,\n              columnNumber: 17\n            }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n              style: {\n                color: \"rgba(255,255,255,0.7)\",\n                fontSize: \"0.9rem\"\n              },\n              children: [pdfState.filename && pdfState.filename.substring(0, 20), \"...\", !amIPresenter() && \" (Solo visualizaciÃ³n)\", amIPresenter() && \" (Presentador âœï¸)\"]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 753,\n              columnNumber: 17\n            }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n              style: {\n                display: 'flex',\n                gap: '10px'\n              },\n              children: [amIPresenter() && /*#__PURE__*/_jsxDEV(_Fragment, {\n                children: !pdfState.isPresenting ? /*#__PURE__*/_jsxDEV(\"button\", {\n                  onClick: () => socketRef.current.emit(\"pdf-toggle-presentation\", {\n                    roomId,\n                    isPresenting: true\n                  }),\n                  style: {\n                    background: \"#10b981\",\n                    border: \"none\",\n                    color: \"white\",\n                    padding: \"5px 10px\",\n                    borderRadius: \"4px\",\n                    cursor: \"pointer\"\n                  },\n                  children: \"\\u25B6 Presentar a Todos\"\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 764,\n                  columnNumber: 25\n                }, this) : /*#__PURE__*/_jsxDEV(\"button\", {\n                  onClick: () => socketRef.current.emit(\"pdf-toggle-presentation\", {\n                    roomId,\n                    isPresenting: false\n                  }),\n                  style: {\n                    background: \"#f59e0b\",\n                    border: \"none\",\n                    color: \"white\",\n                    padding: \"5px 10px\",\n                    borderRadius: \"4px\",\n                    cursor: \"pointer\"\n                  },\n                  children: \"\\u23F8 Pausar Presentaci\\xF3n\"\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 771,\n                  columnNumber: 25\n                }, this)\n              }, void 0, false), amIOwner() && /*#__PURE__*/_jsxDEV(\"button\", {\n                onClick: () => socketRef.current.emit(\"pdf-remove\", {\n                  roomId\n                }),\n                style: {\n                  background: \"#ef4444\",\n                  border: \"none\",\n                  color: \"white\",\n                  padding: \"5px 10px\",\n                  borderRadius: \"4px\",\n                  cursor: \"pointer\"\n                },\n                children: \"Eliminar PDF\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 782,\n                columnNumber: 21\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 760,\n              columnNumber: 17\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 722,\n            columnNumber: 15\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            style: {\n              flex: 1,\n              position: \"relative\",\n              background: \"#525659\",\n              overflow: \"hidden\"\n            },\n            children: /*#__PURE__*/_jsxDEV(\"div\", {\n              style: {\n                position: \"relative\",\n                width: \"100%\",\n                height: \"100%\"\n              },\n              children: [/*#__PURE__*/_jsxDEV(PdfViewer, {\n                fileUrl: `${API_URL}/pdf/file/${pdfState.filename}`,\n                fileType: pdfState.filename.endsWith('.pdf') ? 'application/pdf' : 'image/jpeg',\n                pageNumber: pdfState.currentPage,\n                onPageChange: p => {\n                  // Already handled by socket event usually, but local update too\n                },\n                scale: 1.0,\n                onPageLoadSuccess: pdf => {\n                  if (onPdfLoadSuccess) onPdfLoadSuccess(pdf.numPages);\n                }\n                // Pass ONLY lines for current page\n                ,\n                whiteboardLines: whiteboardData[pdfState.currentPage] || [],\n                onDraw: handleWhiteboardDraw,\n                canDraw: shouldShowControls,\n                tool: activeTool\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 796,\n                columnNumber: 19\n              }, this), shouldShowControls && /*#__PURE__*/_jsxDEV(\"div\", {\n                style: {\n                  position: 'absolute',\n                  top: 10,\n                  left: 10,\n                  display: 'flex',\n                  gap: 5\n                },\n                children: [/*#__PURE__*/_jsxDEV(\"button\", {\n                  onClick: () => setActiveTool(\"pen\"),\n                  style: {\n                    background: activeTool === \"pen\" ? \"#3b82f6\" : \"white\"\n                  },\n                  children: \"\\u270F\\uFE0F\"\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 816,\n                  columnNumber: 23\n                }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n                  onClick: () => setActiveTool(\"eraser\"),\n                  style: {\n                    background: activeTool === \"eraser\" ? \"#ef4444\" : \"white\"\n                  },\n                  children: \"\\uD83E\\uDDF9\"\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 817,\n                  columnNumber: 23\n                }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n                  onClick: handleClearWhiteboard,\n                  style: {\n                    background: \"white\"\n                  },\n                  children: \"\\uD83D\\uDDD1\\uFE0F Page\"\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 818,\n                  columnNumber: 23\n                }, this)]\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 815,\n                columnNumber: 21\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 795,\n              columnNumber: 17\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 793,\n            columnNumber: 15\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 713,\n          columnNumber: 13\n        }, this) : null, /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"video-grid-container\",\n          style: {\n            flex: showPdf && pdfState && (pdfState.isPresenting || amIPresenter()) ? 1 : 1,\n            display: \"grid\",\n            gridTemplateColumns: showPdf && pdfState && (pdfState.isPresenting || amIPresenter()) ? \"1fr\" : \"repeat(auto-fit, minmax(300px, 1fr))\",\n            gridAutoRows: \"minmax(200px, 1fr)\",\n            gap: \"15px\",\n            padding: \"10px\",\n            width: \"100%\",\n            overflowY: \"auto\",\n            alignContent: showPdf && pdfState && (pdfState.isPresenting || amIPresenter()) ? \"start\" : \"center\",\n            maxHeight: showPdf && pdfState && (pdfState.isPresenting || amIPresenter()) ? \"none\" : \"calc(100vh - 150px)\" // adjustments\n          },\n          children: [/*#__PURE__*/_jsxDEV(\"div\", {\n            style: {\n              position: \"relative\",\n              background: \"#1a1a1a\",\n              borderRadius: \"12px\",\n              overflow: \"hidden\",\n              border: isSpeaking ? \"3px solid #10b981\" : \"3px solid transparent\",\n              transition: \"all 0.3s ease\",\n              boxShadow: isSpeaking ? \"0 0 20px rgba(16, 185, 129, 0.5)\" : \"0 4px 6px rgba(0,0,0,0.3)\",\n              aspectRatio: \"16/9\",\n              minHeight: \"150px\"\n            },\n            children: [/*#__PURE__*/_jsxDEV(\"video\", {\n              playsInline: true,\n              muted: true,\n              ref: myVideo,\n              autoPlay: true,\n              style: {\n                width: \"100%\",\n                height: \"100%\",\n                objectFit: \"cover\",\n                transform: !screenStream ? \"scaleX(-1)\" : \"none\",\n                display: videoEnabled || screenStream ? \"block\" : \"none\"\n              }\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 851,\n              columnNumber: 15\n            }, this), !videoEnabled && /*#__PURE__*/_jsxDEV(\"div\", {\n              style: {\n                width: \"100%\",\n                height: \"100%\",\n                display: \"flex\",\n                alignItems: \"center\",\n                justifyContent: \"center\",\n                background: \"linear-gradient(135deg, #667eea 0%, #764ba2 100%)\"\n              },\n              children: /*#__PURE__*/_jsxDEV(\"div\", {\n                style: {\n                  width: \"50px\",\n                  height: \"50px\",\n                  borderRadius: \"50%\",\n                  background: \"rgba(255,255,255,0.2)\",\n                  display: \"flex\",\n                  alignItems: \"center\",\n                  justifyContent: \"center\",\n                  fontSize: \"1.5rem\",\n                  color: \"white\",\n                  fontWeight: \"bold\"\n                },\n                children: user === null || user === void 0 ? void 0 : (_user$nombre = user.nombre) === null || _user$nombre === void 0 ? void 0 : _user$nombre.charAt(0).toUpperCase()\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 873,\n                columnNumber: 19\n              }, this)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 865,\n              columnNumber: 17\n            }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n              style: {\n                position: \"absolute\",\n                bottom: \"10px\",\n                left: \"10px\",\n                background: \"rgba(0,0,0,0.8)\",\n                padding: \"4px 8px\",\n                borderRadius: \"6px\",\n                color: \"white\",\n                fontSize: \"0.8rem\",\n                fontWeight: \"500\"\n              },\n              children: [user === null || user === void 0 ? void 0 : user.nombre, \" (T\\xFA)\"]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 889,\n              columnNumber: 15\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 840,\n            columnNumber: 13\n          }, this), peers.map(({\n            peerID,\n            peer\n          }) => {\n            const participant = participants.find(p => p.socketId === peerID);\n            const name = participant ? participant.nombre : \"Usuario\";\n            return /*#__PURE__*/_jsxDEV(VideoCard, {\n              peer: peer,\n              peerID: peerID,\n              userName: name,\n              isActive: activeSpeakers.has(peerID)\n            }, peerID, false, {\n              fileName: _jsxFileName,\n              lineNumber: 909,\n              columnNumber: 17\n            }, this);\n          })]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 827,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 708,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        style: {\n          display: \"flex\",\n          justifyContent: \"center\",\n          gap: \"15px\",\n          padding: \"15px\",\n          background: \"rgba(255,255,255,0.05)\",\n          borderRadius: \"12px\"\n        },\n        children: [/*#__PURE__*/_jsxDEV(\"button\", {\n          onClick: toggleAudio,\n          style: {\n            padding: \"12px 20px\",\n            borderRadius: \"8px\",\n            border: \"none\",\n            background: audioEnabled ? \"var(--accent-primary)\" : \"#ef4444\",\n            color: \"white\",\n            cursor: \"pointer\",\n            fontSize: \"1rem\",\n            fontWeight: \"500\"\n          },\n          children: audioEnabled ? \"ðŸŽ¤ MicrÃ³fono\" : \"ðŸ”‡ Mutear\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 931,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n          onClick: toggleVideo,\n          style: {\n            padding: \"12px 20px\",\n            borderRadius: \"8px\",\n            border: \"none\",\n            background: videoEnabled ? \"var(--accent-primary)\" : \"#ef4444\",\n            color: \"white\",\n            cursor: \"pointer\",\n            fontSize: \"1rem\",\n            fontWeight: \"500\"\n          },\n          children: videoEnabled ? \"ðŸ“¹ CÃ¡mara\" : \"ðŸ“· Sin Video\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 946,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n          onClick: screenStream ? stopScreenShare : shareScreen,\n          style: {\n            padding: \"12px 20px\",\n            borderRadius: \"8px\",\n            border: \"none\",\n            background: screenStream ? \"#ef4444\" : \"var(--accent-secondary)\",\n            color: \"white\",\n            cursor: \"pointer\",\n            fontSize: \"1rem\",\n            fontWeight: \"500\"\n          },\n          children: screenStream ? \"â¹ï¸ Detener\" : \"ðŸ–¥ï¸ Compartir Pantalla\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 961,\n          columnNumber: 11\n        }, this), pdfState ? amIOwner() && /*#__PURE__*/_jsxDEV(\"button\", {\n          onClick: () => socketRef.current.emit(\"pdf-remove\", {\n            roomId\n          }),\n          style: {\n            padding: \"12px 20px\",\n            borderRadius: \"8px\",\n            border: \"none\",\n            background: \"#ef4444\",\n            color: \"white\",\n            cursor: \"pointer\",\n            fontSize: \"1rem\",\n            fontWeight: \"500\"\n          },\n          children: \"\\uD83D\\uDDD1\\uFE0F Eliminar PDF\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 980,\n          columnNumber: 15\n        }, this) : /*#__PURE__*/_jsxDEV(_Fragment, {\n          children: [/*#__PURE__*/_jsxDEV(\"button\", {\n            onClick: () => {\n              var _fileInputRef$current;\n              return (_fileInputRef$current = fileInputRef.current) === null || _fileInputRef$current === void 0 ? void 0 : _fileInputRef$current.click();\n            },\n            disabled: uploadingPdf,\n            style: {\n              padding: \"12px 20px\",\n              borderRadius: \"8px\",\n              border: \"none\",\n              background: \"#8b5cf6\",\n              color: \"white\",\n              cursor: uploadingPdf ? \"not-allowed\" : \"pointer\",\n              fontSize: \"1rem\",\n              fontWeight: \"500\"\n            },\n            children: uploadingPdf ? \"Subiendo...\" : \"ðŸ“„ Subir PDF\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 998,\n            columnNumber: 15\n          }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n            ref: fileInputRef,\n            type: \"file\",\n            accept: \"application/pdf\",\n            onChange: handlePdfUpload,\n            style: {\n              display: \"none\"\n            }\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 1014,\n            columnNumber: 15\n          }, this)]\n        }, void 0, true), /*#__PURE__*/_jsxDEV(\"button\", {\n          onClick: leaveRoom,\n          style: {\n            padding: \"12px 20px\",\n            borderRadius: \"8px\",\n            border: \"none\",\n            background: \"#dc2626\",\n            color: \"white\",\n            cursor: \"pointer\",\n            fontSize: \"1rem\",\n            fontWeight: \"500\"\n          },\n          children: \"\\uD83D\\uDEAA Salir\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 1023,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 923,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 683,\n      columnNumber: 7\n    }, this), showChat && /*#__PURE__*/_jsxDEV(\"div\", {\n      style: {\n        width: \"350px\",\n        background: \"rgba(30, 30, 40, 0.95)\",\n        borderLeft: \"1px solid rgba(255,255,255,0.1)\",\n        display: \"flex\",\n        flexDirection: \"column\",\n        boxShadow: \"-4px 0 10px rgba(0,0,0,0.3)\"\n      },\n      children: [/*#__PURE__*/_jsxDEV(\"div\", {\n        style: {\n          padding: \"15px\",\n          borderBottom: \"1px solid rgba(255,255,255,0.1)\",\n          background: \"rgba(0,0,0,0.2)\"\n        },\n        children: [/*#__PURE__*/_jsxDEV(\"h3\", {\n          style: {\n            margin: 0,\n            fontSize: \"1rem\",\n            color: \"var(--accent-secondary)\"\n          },\n          children: [\"\\uD83D\\uDC65 Participantes (\", participants.length, \")\"]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 1057,\n          columnNumber: 13\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          style: {\n            maxHeight: \"100px\",\n            overflowY: \"auto\",\n            marginTop: \"10px\"\n          },\n          children: participants.map(p => {\n            var _pdfState$presenters, _socketRef$current3;\n            // Check if presenter\n            const isPresenter = pdfState === null || pdfState === void 0 ? void 0 : (_pdfState$presenters = pdfState.presenters) === null || _pdfState$presenters === void 0 ? void 0 : _pdfState$presenters.includes(p.userId);\n            const canManage = amIOwner() && p.userId !== user.id;\n            return /*#__PURE__*/_jsxDEV(\"div\", {\n              style: {\n                fontSize: \"0.85rem\",\n                color: \"#ccc\",\n                padding: \"2px 0\",\n                display: \"flex\",\n                justifyContent: \"space-between\",\n                alignItems: \"center\"\n              },\n              children: [/*#__PURE__*/_jsxDEV(\"span\", {\n                children: [\"\\u2022 \", p.nombre, \" \", p.socketId === ((_socketRef$current3 = socketRef.current) === null || _socketRef$current3 === void 0 ? void 0 : _socketRef$current3.id) ? \"(TÃº)\" : \"\", isPresenter && \" âœï¸\"]\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 1068,\n                columnNumber: 21\n              }, this), canManage && /*#__PURE__*/_jsxDEV(\"button\", {\n                onClick: () => isPresenter ? revokePresenter(p.userId) : grantPresenter(p.userId),\n                style: {\n                  fontSize: \"0.7rem\",\n                  padding: \"1px 5px\",\n                  cursor: \"pointer\",\n                  background: \"none\",\n                  border: \"1px solid #666\",\n                  color: \"#aaa\",\n                  borderRadius: \"3px\"\n                },\n                children: isPresenter ? \"Quitar Rol\" : \"Hacer Presentador\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 1073,\n                columnNumber: 23\n              }, this)]\n            }, p.socketId || p.userId, true, {\n              fileName: _jsxFileName,\n              lineNumber: 1067,\n              columnNumber: 19\n            }, this);\n          })\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 1060,\n          columnNumber: 13\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 1052,\n        columnNumber: 11\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        style: {\n          padding: \"20px\",\n          borderBottom: \"1px solid rgba(255,255,255,0.1)\",\n          background: \"rgba(0,0,0,0.2)\"\n        },\n        children: [/*#__PURE__*/_jsxDEV(\"h3\", {\n          style: {\n            margin: 0,\n            color: \"var(--text-primary)\",\n            fontSize: \"1.1rem\",\n            fontWeight: \"600\"\n          },\n          children: \"\\uD83D\\uDCAC Chat\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 1091,\n          columnNumber: 13\n        }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n          style: {\n            margin: \"5px 0 0 0\",\n            fontSize: \"0.75rem\",\n            color: \"var(--text-secondary)\"\n          },\n          children: [messages.length, \" mensaje\", messages.length !== 1 ? 's' : '']\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 1099,\n          columnNumber: 13\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 1086,\n        columnNumber: 11\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        style: {\n          flex: 1,\n          overflowY: \"auto\",\n          padding: \"15px\",\n          display: \"flex\",\n          flexDirection: \"column\",\n          gap: \"12px\"\n        },\n        children: [messages.length === 0 ? /*#__PURE__*/_jsxDEV(\"div\", {\n          style: {\n            textAlign: \"center\",\n            color: \"var(--text-secondary)\",\n            padding: \"40px 20px\",\n            fontSize: \"0.9rem\"\n          },\n          children: [/*#__PURE__*/_jsxDEV(\"div\", {\n            style: {\n              fontSize: \"2rem\",\n              marginBottom: \"10px\"\n            },\n            children: \"\\uD83D\\uDCAC\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 1122,\n            columnNumber: 17\n          }, this), \"No hay mensajes a\\xFAn.\", /*#__PURE__*/_jsxDEV(\"br\", {}, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 1123,\n            columnNumber: 37\n          }, this), \"\\xA1S\\xE9 el primero en escribir!\"]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 1116,\n          columnNumber: 15\n        }, this) : messages.map((msg, idx) => {\n          const myId = user.id || user._id; // Robust ID\n          const isMe = msg.userId === myId;\n          const time = new Date(msg.timestamp).toLocaleTimeString('es-ES', {\n            hour: '2-digit',\n            minute: '2-digit'\n          });\n          return /*#__PURE__*/_jsxDEV(\"div\", {\n            style: {\n              display: \"flex\",\n              flexDirection: \"column\",\n              alignItems: isMe ? \"flex-end\" : \"flex-start\",\n              animation: \"fadeIn 0.3s ease\"\n            },\n            children: [!isMe && /*#__PURE__*/_jsxDEV(\"div\", {\n              style: {\n                fontSize: \"0.75rem\",\n                color: \"var(--accent-primary)\",\n                marginBottom: \"3px\",\n                fontWeight: \"600\"\n              },\n              children: msg.userName\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 1143,\n              columnNumber: 23\n            }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n              style: {\n                background: isMe ? \"linear-gradient(135deg, #667eea 0%, #764ba2 100%)\" : \"rgba(255,255,255,0.08)\",\n                padding: \"10px 14px\",\n                borderRadius: isMe ? \"12px 12px 4px 12px\" : \"12px 12px 12px 4px\",\n                maxWidth: \"80%\",\n                wordWrap: \"break-word\",\n                boxShadow: \"0 2px 4px rgba(0,0,0,0.2)\"\n              },\n              children: [/*#__PURE__*/_jsxDEV(\"div\", {\n                style: {\n                  color: \"var(--text-primary)\",\n                  fontSize: \"0.95rem\",\n                  lineHeight: \"1.4\"\n                },\n                children: msg.texto\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 1162,\n                columnNumber: 23\n              }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n                style: {\n                  fontSize: \"0.7rem\",\n                  color: isMe ? \"rgba(255,255,255,0.7)\" : \"var(--text-secondary)\",\n                  marginTop: \"4px\",\n                  textAlign: \"right\"\n                },\n                children: time\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 1169,\n                columnNumber: 23\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 1152,\n              columnNumber: 21\n            }, this)]\n          }, idx, true, {\n            fileName: _jsxFileName,\n            lineNumber: 1136,\n            columnNumber: 19\n          }, this);\n        }), /*#__PURE__*/_jsxDEV(\"div\", {\n          ref: chatEndRef\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 1182,\n          columnNumber: 13\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 1107,\n        columnNumber: 11\n      }, this), /*#__PURE__*/_jsxDEV(\"form\", {\n        onSubmit: sendMessage,\n        style: {\n          padding: \"15px\",\n          borderTop: \"1px solid rgba(255,255,255,0.1)\",\n          display: \"flex\",\n          gap: \"10px\",\n          background: \"rgba(0,0,0,0.2)\"\n        },\n        children: [/*#__PURE__*/_jsxDEV(\"input\", {\n          type: \"text\",\n          value: newMessage,\n          onChange: e => setNewMessage(e.target.value),\n          placeholder: \"Escribe un mensaje...\",\n          style: {\n            flex: 1,\n            padding: \"12px\",\n            borderRadius: \"8px\",\n            border: \"1px solid rgba(255,255,255,0.1)\",\n            background: \"rgba(255,255,255,0.05)\",\n            color: \"var(--text-primary)\",\n            fontSize: \"0.95rem\",\n            outline: \"none\",\n            transition: \"all 0.2s\"\n          },\n          onFocus: e => e.target.style.borderColor = \"var(--accent-primary)\",\n          onBlur: e => e.target.style.borderColor = \"rgba(255,255,255,0.1)\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 1191,\n          columnNumber: 13\n        }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n          type: \"submit\",\n          className: \"btn\",\n          style: {\n            padding: \"12px 20px\",\n            minWidth: \"70px\",\n            fontSize: \"0.9rem\"\n          },\n          disabled: !newMessage.trim(),\n          children: \"Enviar\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 1210,\n          columnNumber: 13\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 1184,\n        columnNumber: 11\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 1043,\n      columnNumber: 9\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 681,\n    columnNumber: 5\n  }, this);\n}\n_s(Room, \"xeTGlXf741DN4JR8apf2WfpPWi0=\", false, function () {\n  return [useParams, useAuth, useNavigate, useAudioLevel];\n});\n_c = Room;\nfunction VideoCard({\n  peer,\n  peerID,\n  isActive,\n  userName\n}) {\n  _s2();\n  const ref = useRef();\n  const [hasVideo, setHasVideo] = useState(true);\n  const [status, setStatus] = useState(\"Conectando...\");\n  const [debugInfo, setDebugInfo] = useState(\"\");\n  useEffect(() => {\n    // 1. Define event handler\n    const handleStream = stream => {\n      console.log(`VideoCard: Stream received for ${peerID}`, stream.getTracks());\n      if (ref.current) {\n        ref.current.srcObject = stream;\n        const videoTracks = stream.getVideoTracks();\n        setHasVideo(videoTracks.length > 0 && videoTracks[0].enabled);\n        setStatus(\"Conectado ðŸŸ¢\");\n      }\n    };\n\n    // 2. Listen for event\n    peer.on(\"stream\", handleStream);\n\n    // 3. CRITICAL: Check if stream already exists (missed event)\n    if (peer._remoteStreams && peer._remoteStreams.length > 0) {\n      console.log(`VideoCard: Found existing stream for ${peerID}`);\n      handleStream(peer._remoteStreams[0]);\n    }\n    peer.on(\"connect\", () => {\n      console.log(`VideoCard: Peer ${peerID} connected`);\n      setStatus(\"Negociando medios... ðŸŸ¡\");\n    });\n    peer.on(\"error\", err => {\n      console.error(`VideoCard: Peer error for ${peerID}:`, err);\n      setStatus(`Error: ${err.code || err.message} ðŸ”´`);\n      setDebugInfo(err.toString());\n    });\n    peer.on(\"close\", () => {\n      setStatus(\"Desconectado âš«\");\n    });\n\n    // Handle track mute/unmute events\n    peer.on(\"track\", (track, stream) => {\n      track.onmute = () => {\n        if (track.kind === 'video') setHasVideo(false);\n      };\n      track.onunmute = () => {\n        if (track.kind === 'video') setHasVideo(true);\n      };\n    });\n  }, [peer, peerID]);\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    style: {\n      position: \"relative\",\n      background: \"#1a1a1a\",\n      borderRadius: \"12px\",\n      overflow: \"hidden\",\n      border: isActive ? \"3px solid #10b981\" : \"3px solid transparent\",\n      transition: \"all 0.3s ease\",\n      boxShadow: isActive ? \"0 0 20px rgba(16, 185, 129, 0.5)\" : \"0 4px 6px rgba(0,0,0,0.3)\",\n      aspectRatio: \"16/9\",\n      minHeight: \"200px\"\n    },\n    children: [/*#__PURE__*/_jsxDEV(\"video\", {\n      playsInline: true,\n      autoPlay: true,\n      ref: ref,\n      id: `video-${peerID}`,\n      style: {\n        width: \"100%\",\n        height: \"100%\",\n        objectFit: \"cover\",\n        display: hasVideo ? \"block\" : \"none\",\n        backgroundColor: \"#000\" // Ensure black background if loading\n      }\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 1297,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      style: {\n        position: \"absolute\",\n        top: \"5px\",\n        left: \"5px\",\n        zIndex: 10,\n        background: \"rgba(0,0,0,0.6)\",\n        padding: \"2px 6px\",\n        borderRadius: \"4px\",\n        fontSize: \"0.7rem\",\n        color: status.includes(\"Error\") ? \"#ff4444\" : \"#ffffff\",\n        pointerEvents: \"none\"\n      },\n      children: status\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 1312,\n      columnNumber: 7\n    }, this), !hasVideo && /*#__PURE__*/_jsxDEV(\"div\", {\n      style: {\n        width: \"100%\",\n        height: \"100%\",\n        display: \"flex\",\n        flexDirection: \"column\",\n        alignItems: \"center\",\n        justifyContent: \"center\",\n        background: \"linear-gradient(135deg, #f093fb 0%, #f5576c 100%)\",\n        position: \"absolute\",\n        top: 0,\n        left: 0\n      },\n      children: [/*#__PURE__*/_jsxDEV(\"div\", {\n        style: {\n          width: \"80px\",\n          height: \"80px\",\n          borderRadius: \"50%\",\n          background: \"rgba(255,255,255,0.2)\",\n          display: \"flex\",\n          alignItems: \"center\",\n          justifyContent: \"center\",\n          fontSize: \"2rem\",\n          color: \"white\",\n          fontWeight: \"bold\",\n          marginBottom: \"10px\"\n        },\n        children: \"\\uD83D\\uDC64\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 1340,\n        columnNumber: 11\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        style: {\n          color: \"white\",\n          fontSize: \"0.8rem\"\n        },\n        children: \"C\\xE1mara apagada\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 1355,\n        columnNumber: 11\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 1328,\n      columnNumber: 9\n    }, this), debugInfo && /*#__PURE__*/_jsxDEV(\"div\", {\n      style: {\n        position: \"absolute\",\n        bottom: \"40px\",\n        left: \"0\",\n        right: \"0\",\n        background: \"rgba(255,0,0,0.8)\",\n        color: \"white\",\n        fontSize: \"0.7rem\",\n        padding: \"5px\",\n        wordBreak: \"break-all\"\n      },\n      children: debugInfo\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 1361,\n      columnNumber: 9\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      style: {\n        position: \"absolute\",\n        bottom: \"10px\",\n        left: \"10px\",\n        background: \"rgba(0,0,0,0.8)\",\n        padding: \"6px 12px\",\n        borderRadius: \"6px\",\n        color: \"white\",\n        fontSize: \"0.9rem\",\n        fontWeight: \"500\"\n      },\n      children: userName || \"Participante\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 1376,\n      columnNumber: 7\n    }, this), isActive && /*#__PURE__*/_jsxDEV(\"div\", {\n      style: {\n        position: \"absolute\",\n        top: \"10px\",\n        right: \"10px\",\n        background: \"rgba(16, 185, 129, 0.9)\",\n        padding: \"4px 8px\",\n        borderRadius: \"4px\",\n        color: \"white\",\n        fontSize: \"0.75rem\",\n        fontWeight: \"600\"\n      },\n      children: \"\\uD83C\\uDFA4 Hablando\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 1390,\n      columnNumber: 9\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 1286,\n    columnNumber: 5\n  }, this);\n}\n_s2(VideoCard, \"BeZncSii+EA3CngYxmYjhqbJZGo=\");\n_c2 = VideoCard;\nexport default Room;\nvar _c, _c2;\n$RefreshReg$(_c, \"Room\");\n$RefreshReg$(_c2, \"VideoCard\");","map":{"version":3,"names":["React","useEffect","useRef","useState","useParams","useNavigate","Peer","io","useAuth","useAudioLevel","axios","PdfViewer","GroupManager","jsxDEV","_jsxDEV","Fragment","_Fragment","peerConfig","iceServers","urls","API_URL","window","location","origin","Room","_s","_user$nombre","roomId","user","navigate","myStream","setMyStream","peers","setPeers","participants","setParticipants","screenStream","setScreenStream","audioEnabled","setAudioEnabled","videoEnabled","setVideoEnabled","showChat","setShowChat","showPdf","setShowPdf","messages","setMessages","newMessage","setNewMessage","pdfState","setPdfState","uploadingPdf","setUploadingPdf","whiteboardData","setWhiteboardData","currentPage","setCurrentPage","activeTool","setActiveTool","groups","setGroups","activeSpeakers","setActiveSpeakers","Set","myVideo","socketRef","streamRef","peersRef","chatEndRef","fileInputRef","iceCandidatesQueue","host","hostname","isSpeaking","_socketRef$current","current","emit","userId","id","userName","nombre","_socketRef$current2","navigator","mediaDevices","getUserMedia","alert","href","connect","socket","loadChatHistory","video","audio","then","currentStream","srcObject","_id","catch","err","console","error","on","users","log","JSON","stringify","forEach","participant","socketId","createPeer","newUserId","newParticipants","offer","from","existingPeer","find","p","peerID","peer","signal","addPeer","push","length","candidate","warn","answer","item","peerObj","destroy","filter","prev","newSet","delete","message","setTimeout","_chatEndRef$current","scrollIntoView","behavior","pdfData","presenters","line","page","pageLines","updatedGroups","add","getTracks","track","stop","disconnect","userToSignal","callerID","stream","initiator","config","type","to","incomingSignal","response","get","data","_chatEndRef$current2","sendMessage","e","preventDefault","trim","messageData","texto","timestamp","Date","toggleAudio","audioTrack","getAudioTracks","enabled","toggleVideo","videoTrack","getVideoTracks","handlePdfUpload","file","target","files","formData","FormData","append","token","localStorage","getItem","post","headers","pdf","amIPresenter","linkedGroupId","group","g","myId","members","includes","amIOwner","ownerId","uploadedBy","String","changePdfPage","direction","newPage","totalPages","handleWhiteboardDraw","fileOwnerId","lineWithTool","tool","handleClearWhiteboard","grantPresenter","targetId","targetUserId","revokePresenter","onPdfLoadSuccess","numPages","shareScreen","getDisplayMedia","screenTrack","sender","_pc","getSenders","s","kind","replaceTrack","onended","stopScreenShare","name","leaveRoom","shouldShowControls","style","display","height","background","children","flex","flexDirection","padding","overflow","marginBottom","justifyContent","alignItems","color","margin","fileName","_jsxFileName","lineNumber","columnNumber","gap","onClick","className","fontSize","currentPdf","isPresenting","borderRadius","disabled","opacity","filename","substring","border","cursor","position","width","fileUrl","fileType","endsWith","pageNumber","onPageChange","scale","onPageLoadSuccess","whiteboardLines","onDraw","canDraw","top","left","gridTemplateColumns","gridAutoRows","overflowY","alignContent","maxHeight","transition","boxShadow","aspectRatio","minHeight","playsInline","muted","ref","autoPlay","objectFit","transform","fontWeight","charAt","toUpperCase","bottom","map","VideoCard","isActive","has","_fileInputRef$current","click","accept","onChange","borderLeft","borderBottom","marginTop","_pdfState$presenters","_socketRef$current3","isPresenter","canManage","textAlign","msg","idx","isMe","time","toLocaleTimeString","hour","minute","animation","maxWidth","wordWrap","lineHeight","onSubmit","borderTop","value","placeholder","outline","onFocus","borderColor","onBlur","minWidth","_c","_s2","hasVideo","setHasVideo","status","setStatus","debugInfo","setDebugInfo","handleStream","videoTracks","_remoteStreams","code","toString","onmute","onunmute","backgroundColor","zIndex","pointerEvents","right","wordBreak","_c2","$RefreshReg$"],"sources":["/home/cristian/Documentos/7mo/lenguajes_programacion/Videoconferencia-app/client/src/pages/Room.js"],"sourcesContent":["import React, { useEffect, useRef, useState } from \"react\";\nimport { useParams, useNavigate } from \"react-router-dom\";\nimport Peer from \"simple-peer\";\nimport io from \"socket.io-client\";\nimport { useAuth } from \"../context/AuthContext\";\nimport { useAudioLevel } from \"../hooks/useAudioLevel\";\nimport axios from \"axios\";\nimport PdfViewer from \"../components/PdfViewer\";\nimport GroupManager from \"../components/GroupManager\";\n\n// WebRTC Configuration\nconst peerConfig = {\n  iceServers: [\n    { urls: 'stun:stun.l.google.com:19302' },\n    { urls: 'stun:global.stun.twilio.com:3478' }\n  ]\n};\n\nconst API_URL = window.location.origin + '/api';\n\nfunction Room() {\n  const { roomId } = useParams();\n  const { user } = useAuth();\n  const navigate = useNavigate();\n\n  // Media streams\n  const [myStream, setMyStream] = useState(null);\n  const [peers, setPeers] = useState([]);\n  const [participants, setParticipants] = useState([]);\n  const [screenStream, setScreenStream] = useState(null);\n\n  // UI state\n  const [audioEnabled, setAudioEnabled] = useState(true);\n  const [videoEnabled, setVideoEnabled] = useState(true);\n  const [showChat, setShowChat] = useState(true);\n  const [showPdf, setShowPdf] = useState(false);\n\n  // Chat\n  const [messages, setMessages] = useState([]);\n  const [newMessage, setNewMessage] = useState(\"\");\n\n  // PDF\n  const [pdfState, setPdfState] = useState(null);\n  const [uploadingPdf, setUploadingPdf] = useState(false);\n  const [whiteboardData, setWhiteboardData] = useState({}); // { 1: [lines], 2: [lines] ... }\n  const [currentPage, setCurrentPage] = useState(1);\n  const [activeTool, setActiveTool] = useState(\"pen\"); // pen, eraser // Array of lines\n\n  // Groups\n  const [groups, setGroups] = useState([]);\n\n  // Active speakers\n  const [activeSpeakers, setActiveSpeakers] = useState(new Set());\n\n  // Refs\n  const myVideo = useRef();\n  const socketRef = useRef();\n  const streamRef = useRef();\n  const peersRef = useRef([]);\n  const chatEndRef = useRef();\n  const fileInputRef = useRef();\n  const iceCandidatesQueue = useRef({}); // Buffer for out-of-order candidates\n\n  const host = window.location.hostname;\n  const API_URL = '/api';\n\n  // Detect if I'm speaking\n  const isSpeaking = useAudioLevel(myStream);\n\n  useEffect(() => {\n    if (isSpeaking) {\n      socketRef.current?.emit(\"user-speaking\", {\n        roomId,\n        userId: user.id,\n        userName: user.nombre\n      });\n    } else {\n      socketRef.current?.emit(\"user-stopped-speaking\", {\n        roomId,\n        userId: user.id\n      });\n    }\n  }, [isSpeaking]);\n\n  useEffect(() => {\n    // Check if mediaDevices is available (requires HTTPS or localhost)\n    if (!navigator.mediaDevices || !navigator.mediaDevices.getUserMedia) {\n      alert(\n        \"âš ï¸ WebRTC no estÃ¡ disponible.\\n\\n\" +\n        \"Para usar video/audio, debes acceder desde:\\n\" +\n        \"â€¢ http://localhost:3000 (en este equipo)\\n\" +\n        \"â€¢ https://... (conexiÃ³n segura)\\n\\n\" +\n        \"Actualmente estÃ¡s en: \" + window.location.href + \"\\n\\n\" +\n        \"El chat y PDF funcionarÃ¡n, pero no el video.\"\n      );\n      // Continue without video/audio\n      socketRef.current = io.connect(window.location.origin);\n      const socket = socketRef.current;\n\n      socket.emit(\"join-room\", {\n        roomId,\n        userId: user.id,\n        userName: user.nombre\n      });\n\n      loadChatHistory();\n      return;\n    }\n\n    // Initialize socket\n    socketRef.current = io.connect(window.location.origin);\n    const socket = socketRef.current;\n\n    // Get user media\n    navigator.mediaDevices\n      .getUserMedia({ video: true, audio: true })\n      .then((currentStream) => {\n        setMyStream(currentStream);\n        // Save stream to ref for access in event listeners\n        streamRef.current = currentStream;\n\n        if (myVideo.current) {\n          myVideo.current.srcObject = currentStream;\n        }\n\n        // Join room\n        socket.emit(\"join-room\", {\n          roomId,\n          userId: user.id || user._id, // Handle fallback\n          userName: user.nombre\n        });\n\n        // Load chat history\n        loadChatHistory();\n      })\n      .catch((err) => {\n        console.error(\"Error accessing media devices:\", err);\n        alert(\n          \"No se pudo acceder a la cÃ¡mara o micrÃ³fono.\\n\\n\" +\n          \"Posibles causas:\\n\" +\n          \"â€¢ Permisos denegados\\n\" +\n          \"â€¢ CÃ¡mara/micrÃ³fono en uso por otra app\\n\" +\n          \"â€¢ Dispositivos no disponibles\\n\\n\" +\n          \"El chat y PDF funcionarÃ¡n normalmente.\"\n        );\n\n        // Continue without video/audio\n        socket.emit(\"join-room\", {\n          roomId,\n          userId: user.id || user._id, // Handle fallback\n          userName: user.nombre\n        });\n\n        loadChatHistory();\n      });\n\n\n\n    // Socket event listeners\n    socket.on(\"room-participants\", (users) => {\n      console.log(\"Current participants payload:\", JSON.stringify(users, null, 2));\n      setParticipants(users);\n\n      // Create peers for existing participants\n      users.forEach((participant) => {\n        if (participant.socketId !== socket.id && participant.socketId) {\n          // Use stream from ref to ensure we have latest stream\n          createPeer(participant.socketId, socket.id, streamRef.current);\n        }\n      });\n    });\n\n    socket.on(\"user-joined\", ({ userId: newUserId, userName, participants: newParticipants }) => {\n      console.log(`User joined event: ${userName}, ID: ${newUserId}`);\n      console.log(\"Full participants list updated:\", JSON.stringify(newParticipants, null, 2));\n      setParticipants(newParticipants);\n      // The new user will initiate the connection\n    });\n\n    socket.on(\"offer\", ({ offer, from }) => {\n      console.log(\"Received signal (offer/candidate) from:\", from);\n\n      const existingPeer = peersRef.current.find((p) => p.peerID === from);\n      if (existingPeer) {\n        // If peer exists, just signal it (for trickle ICE candidates)\n        existingPeer.peer.signal(offer);\n        return;\n      }\n\n      // Use stream from ref\n      if (streamRef.current) {\n        const peer = addPeer(offer, from, streamRef.current);\n        peersRef.current.push({\n          peerID: from,\n          peer\n        });\n        setPeers([...peersRef.current]);\n\n        // Process any queued candidates for this peer\n        if (iceCandidatesQueue.current[from]) {\n          console.log(`Processing ${iceCandidatesQueue.current[from].length} queued candidates for ${from}`);\n          iceCandidatesQueue.current[from].forEach(candidate => {\n            peer.signal(candidate);\n          });\n          delete iceCandidatesQueue.current[from];\n        }\n\n      } else {\n        console.warn(\"Cannot accept offer, no stream available\");\n      }\n    });\n\n    socket.on(\"answer\", ({ answer, from }) => {\n      const item = peersRef.current.find((p) => p.peerID === from);\n      if (item) {\n        item.peer.signal(answer);\n      }\n    });\n\n    socket.on(\"ice-candidate\", ({ candidate, from }) => {\n      const item = peersRef.current.find((p) => p.peerID === from);\n      if (item) {\n        item.peer.signal(candidate);\n      } else {\n        // Queue the candidate if peer not ready yet\n        console.log(`Queueing candidate for unknown peer ${from}`);\n        if (!iceCandidatesQueue.current[from]) {\n          iceCandidatesQueue.current[from] = [];\n        }\n        iceCandidatesQueue.current[from].push(candidate);\n      }\n    });\n\n    socket.on(\"user-left\", ({ socketId, participants: newParticipants }) => {\n      const peerObj = peersRef.current.find((p) => p.peerID === socketId);\n      if (peerObj) {\n        peerObj.peer.destroy();\n      }\n      peersRef.current = peersRef.current.filter((p) => p.peerID !== socketId);\n      setPeers([...peersRef.current]);\n      setParticipants(newParticipants);\n\n      setActiveSpeakers(prev => {\n        const newSet = new Set(prev);\n        newSet.delete(socketId);\n        return newSet;\n      });\n    });\n\n    // Chat events\n    socket.on(\"receive-message\", (message) => {\n      setMessages((prev) => [...prev, message]);\n      setTimeout(() => chatEndRef.current?.scrollIntoView({ behavior: \"smooth\" }), 100);\n    });\n\n    // PDF events\n    socket.on(\"pdf-state\", (pdfData) => {\n      console.log(\"Room.js: Received pdf-state:\", pdfData);\n      setPdfState(pdfData);\n      setShowPdf(true); // Auto-show on new PDF\n    });\n\n    socket.on(\"pdf-page-update\", ({ currentPage }) => {\n      setPdfState((prev) => prev ? { ...prev, currentPage } : null);\n    });\n\n    socket.on(\"pdf-removed\", () => {\n      setPdfState(null);\n      setShowPdf(false);\n      setWhiteboardData({});\n    });\n\n    socket.on(\"pdf-presenters-update\", ({ presenters }) => {\n      setPdfState(prev => prev ? { ...prev, presenters } : null);\n    });\n\n    socket.on(\"whiteboard-draw\", ({ line, page }) => {\n      // line includes { points, color, width }\n      setWhiteboardData(prev => {\n        const pageLines = prev[page] || [];\n        return { ...prev, [page]: [...pageLines, line] };\n      });\n    });\n\n    socket.on(\"whiteboard-clear\", ({ page }) => {\n      setWhiteboardData(prev => ({ ...prev, [page]: [] }));\n    });\n\n    // Group events\n    socket.on(\"groups-update\", (updatedGroups) => {\n      setGroups(updatedGroups);\n    });\n\n    socket.on(\"error-permission\", ({ message }) => {\n      alert(message);\n    });\n\n    // Active speaker events\n    socket.on(\"user-speaking\", ({ socketId }) => {\n      setActiveSpeakers(prev => new Set(prev).add(socketId));\n    });\n\n    socket.on(\"user-stopped-speaking\", ({ socketId }) => {\n      setActiveSpeakers(prev => {\n        const newSet = new Set(prev);\n        newSet.delete(socketId);\n        return newSet;\n      });\n    });\n\n    // Screen sharing events\n    socket.on(\"screen-share-active\", ({ socketId }) => {\n      console.log(\"Screen share started by:\", socketId);\n    });\n\n    socket.on(\"screen-share-ended\", () => {\n      console.log(\"Screen share ended\");\n    });\n\n    // Cleanup\n    return () => {\n      if (myStream) {\n        myStream.getTracks().forEach((track) => track.stop());\n      }\n      if (screenStream) {\n        screenStream.getTracks().forEach((track) => track.stop());\n      }\n      peersRef.current.forEach(({ peer }) => peer.destroy());\n      socket.disconnect();\n    };\n  }, [roomId]);\n\n  function createPeer(userToSignal, callerID, stream) {\n    const peer = new Peer({\n      initiator: true,\n      stream,\n      config: peerConfig\n    });\n\n    peer.on(\"signal\", (signal) => {\n      console.log(\"Generating signal (initiator):\", signal.type, \"for\", userToSignal);\n\n      if (signal.type === 'offer') {\n        socketRef.current.emit(\"offer\", {\n          roomId,\n          offer: signal,\n          to: userToSignal\n        });\n      } else if (signal.candidate || signal.type === 'candidate') {\n        socketRef.current.emit(\"ice-candidate\", {\n          roomId,\n          candidate: signal,\n          to: userToSignal\n        });\n      }\n    });\n\n    peer.on(\"connect\", () => {\n      console.log(\"Peer Connection Established with:\", userToSignal);\n    });\n\n    // Add to peers ref immediately\n    peersRef.current.push({\n      peerID: userToSignal,\n      peer\n    });\n    setPeers([...peersRef.current]);\n\n    return peer;\n  }\n\n  function addPeer(incomingSignal, callerID, stream) {\n    const peer = new Peer({\n      initiator: false,\n      stream,\n      config: peerConfig\n    });\n\n    peer.on(\"signal\", (signal) => {\n      console.log(\"Generating signal (receiver):\", signal.type, \"for\", callerID);\n\n      if (signal.type === 'answer') {\n        socketRef.current.emit(\"answer\", {\n          roomId,\n          answer: signal,\n          to: callerID\n        });\n      } else if (signal.candidate || signal.type === 'candidate') {\n        socketRef.current.emit(\"ice-candidate\", {\n          roomId,\n          candidate: signal,\n          to: callerID\n        });\n      }\n    });\n\n    peer.on(\"connect\", () => {\n      console.log(\"Peer Connection Established with:\", callerID);\n    });\n\n    peer.signal(incomingSignal);\n\n    return peer;\n  }\n\n  const loadChatHistory = async () => {\n    try {\n      const response = await axios.get(`${API_URL}/chat/${roomId}`);\n      setMessages(response.data.messages);\n      setTimeout(() => chatEndRef.current?.scrollIntoView(), 100);\n    } catch (error) {\n      console.error(\"Error loading chat:\", error);\n    }\n  };\n\n  const sendMessage = (e) => {\n    e.preventDefault();\n    if (newMessage.trim()) {\n      const messageData = {\n        roomId,\n        userId: user.id || user._id,\n        userName: user.nombre,\n        texto: newMessage,\n        timestamp: new Date()\n      };\n      socketRef.current.emit(\"send-message\", messageData);\n      setNewMessage(\"\");\n    }\n  };\n\n  const toggleAudio = () => {\n    if (myStream) {\n      const audioTrack = myStream.getAudioTracks()[0];\n      audioTrack.enabled = !audioTrack.enabled;\n      setAudioEnabled(audioTrack.enabled);\n\n      socketRef.current.emit(\"toggle-audio\", {\n        roomId,\n        userId: user.id || user._id,\n        audioEnabled: audioTrack.enabled\n      });\n    }\n  };\n\n  const toggleVideo = () => {\n    if (myStream) {\n      const videoTrack = myStream.getVideoTracks()[0];\n      videoTrack.enabled = !videoTrack.enabled;\n      setVideoEnabled(videoTrack.enabled);\n\n      socketRef.current.emit(\"toggle-video\", {\n        roomId,\n        userId: user.id || user._id,\n        videoEnabled: videoTrack.enabled\n      });\n    }\n  };\n\n  const handlePdfUpload = async (e) => {\n    const file = e.target.files[0];\n    if (!file || file.type !== \"application/pdf\") {\n      alert(\"Por favor selecciona un archivo PDF\");\n      return;\n    }\n\n    setUploadingPdf(true);\n    const formData = new FormData();\n    formData.append(\"pdf\", file);\n    formData.append(\"totalPages\", \"1\");\n\n    try {\n      // NOTE: With pdfjs-dist on client, we could count pages first then upload.\n      // But for now, let's keep simplistic upload. \n      // The backend should ideally count pages, but pdfjs needs binary there.\n      // Let's stick to uploading, receiving state, then viewer renders.\n      // But wait! Page 1/1 bug was due to not knowing totalPages.\n      // Frontend PdfViewer will determine totalPages now.\n\n      const token = localStorage.getItem(\"token\");\n      if (!token) {\n        alert(\"No hay sesiÃ³n activa\");\n        return;\n      }\n\n      const response = await axios.post(\n        `${API_URL}/pdf/upload/${roomId}`,\n        formData,\n        {\n          headers: {\n            \"Content-Type\": \"multipart/form-data\",\n            \"Authorization\": `Bearer ${token}`\n          }\n        }\n      );\n\n      const pdfData = response.data.pdf;\n      // Socket event is emitted by server as 'pdf-state' or we emit 'pdf-uploaded'? \n      // Current pattern: Server receives upload -> updates DB -> emits 'pdf-state' ??\n      // Let's check server...\n      // Server DOES NOT emit 'pdf-state' automatically in upload route.\n      // Server waits for 'pdf-uploaded' socket event from client.\n\n      socketRef.current.emit(\"pdf-uploaded\", { roomId, pdfData });\n      // Don't set state immediately, wait for socket ack to be in sync? \n      // Or set local optimizingly.\n      setPdfState(pdfData);\n      setShowPdf(true);\n    } catch (error) {\n      console.error(\"Error uploading PDF:\", error);\n      alert(\"Error al subir PDF\");\n    } finally {\n      setUploadingPdf(false);\n    }\n  };\n\n  /* \n   * NEW: Check if I am a presenter \n   */\n  const amIPresenter = () => {\n    // If Group Linked, check group membership\n    if (pdfState && pdfState.linkedGroupId) {\n      const group = groups.find(g => g._id === pdfState.linkedGroupId);\n      if (group) {\n        const myId = user.id || user._id;\n        return group.members.includes(myId);\n      }\n    }\n\n    if (!pdfState || !pdfState.presenters) return false;\n    const myId = user.id || user._id; // Robust ID check\n    return pdfState.presenters.includes(myId);\n  };\n\n  const amIOwner = () => {\n    if (!pdfState) return false;\n    const myId = user.id || user._id;\n    // Robust check: compare as strings\n    const ownerId = pdfState.ownerId || pdfState.uploadedBy;\n    if (!ownerId) return false;\n\n    return String(ownerId) === String(myId);\n  };\n\n  const changePdfPage = (direction) => {\n    if (!pdfState) return;\n    if (!amIPresenter()) return; // Permissions check\n\n    let newPage = pdfState.currentPage + direction;\n    if (newPage < 1) newPage = 1;\n    if (newPage > pdfState.totalPages) newPage = pdfState.totalPages;\n\n    socketRef.current.emit(\"pdf-page-changed\", { roomId, currentPage: newPage, userId: user.id || user._id });\n    // Optimistic update\n    setPdfState({ ...pdfState, currentPage: newPage });\n  };\n\n  const handleWhiteboardDraw = (line) => {\n    // line is { points: [x1, y1, x2, y2], color, ... }\n    const fileOwnerId = user.id || user._id;\n    const page = pdfState ? pdfState.currentPage : 1;\n\n    // Add page info to line if needed by components, but mainly for storage\n    const lineWithTool = { ...line, tool: activeTool };\n\n    socketRef.current.emit(\"whiteboard-draw\", { roomId, line: lineWithTool, userId: fileOwnerId, page });\n\n    setWhiteboardData(prev => {\n      const pageLines = prev[page] || [];\n      return { ...prev, [page]: [...pageLines, lineWithTool] };\n    });\n  };\n\n  const handleClearWhiteboard = () => {\n    const page = pdfState ? pdfState.currentPage : 1;\n    socketRef.current.emit(\"whiteboard-clear\", { roomId, page });\n    setWhiteboardData(prev => ({ ...prev, [page]: [] }));\n  };\n\n  const grantPresenter = (targetId) => {\n    socketRef.current.emit(\"pdf-grant-presenter\", { roomId, targetUserId: targetId });\n  };\n\n  const revokePresenter = (targetId) => {\n    socketRef.current.emit(\"pdf-revoke-presenter\", { roomId, targetUserId: targetId });\n  };\n\n  // Helper handling PDF page load to update total pages if needed (fix 1/1 bug)\n  const onPdfLoadSuccess = (numPages) => {\n    if (pdfState && pdfState.totalPages !== numPages) {\n      setPdfState(prev => ({ ...prev, totalPages: numPages }));\n      // Sync with server\n      socketRef.current.emit(\"pdf-update-metadata\", { roomId, totalPages: numPages });\n    }\n  };\n\n  const shareScreen = async () => {\n    if (!navigator.mediaDevices || !navigator.mediaDevices.getDisplayMedia) {\n      alert(\"Compartir pantalla requiere HTTPS o localhost\");\n      return;\n    }\n\n    try {\n      const screenStream = await navigator.mediaDevices.getDisplayMedia({\n        video: true,\n        audio: false\n      });\n\n      setScreenStream(screenStream);\n\n      const screenTrack = screenStream.getVideoTracks()[0];\n\n      // Replace video track for all peers\n      peersRef.current.forEach(({ peer }) => {\n        // Find the video track in the current sender\n        const sender = peer._pc.getSenders().find(s => s.track.kind === 'video');\n        if (sender) {\n          sender.replaceTrack(screenTrack);\n        }\n      });\n\n      // Notify server\n      socketRef.current.emit(\"screen-share-started\", {\n        roomId,\n        userId: user.id\n      });\n\n      // Update local video to show screen share verify it works\n      if (myVideo.current) {\n        myVideo.current.srcObject = screenStream;\n      }\n\n      screenTrack.onended = () => {\n        stopScreenShare();\n      };\n    } catch (error) {\n      console.error(\"Error sharing screen:\", error);\n      if (error.name === 'NotAllowedError') {\n        // User cancelled\n      } else {\n        alert(\"Error al compartir pantalla: \" + error.message);\n      }\n    }\n  };\n\n  const stopScreenShare = () => {\n    if (screenStream) {\n      screenStream.getTracks().forEach((track) => track.stop());\n      setScreenStream(null);\n\n      // Revert to camera track\n      if (streamRef.current) {\n        const videoTrack = streamRef.current.getVideoTracks()[0];\n\n        peersRef.current.forEach(({ peer }) => {\n          const sender = peer._pc.getSenders().find(s => s.track.kind === 'video');\n          if (sender) {\n            sender.replaceTrack(videoTrack);\n          }\n        });\n\n        // Restore local video\n        if (myVideo.current) {\n          myVideo.current.srcObject = streamRef.current;\n        }\n      }\n\n      socketRef.current.emit(\"screen-share-stopped\", { roomId });\n    }\n  };\n\n  const leaveRoom = () => {\n    if (myStream) {\n      myStream.getTracks().forEach((track) => track.stop());\n    }\n    navigate(\"/\");\n  };\n\n  const shouldShowControls = amIPresenter();\n\n  return (\n    <div style={{ display: \"flex\", height: \"100vh\", background: \"var(--bg-primary)\" }}>\n      {/* Main video area OR PDF area */}\n      <div style={{ flex: 1, display: \"flex\", flexDirection: \"column\", padding: \"20px\", overflow: \"hidden\" }}>\n        {/* Header */}\n        <div style={{ marginBottom: \"20px\", display: \"flex\", justifyContent: \"space-between\", alignItems: \"center\" }}>\n          <h2 style={{ color: \"var(--text-secondary)\", margin: 0 }}>\n            Sala: <span style={{ color: \"var(--accent-primary)\" }}>{roomId}</span>\n          </h2>\n          <div style={{ display: \"flex\", gap: \"10px\" }}>\n            <button\n              onClick={() => setShowChat(!showChat)}\n              className=\"btn\"\n              style={{ padding: \"8px 16px\", fontSize: \"0.9rem\" }}\n            >\n              {showChat ? \"Ocultar\" : \"Mostrar\"} Chat\n            </button>\n            <GroupManager\n              roomId={roomId}\n              socket={socketRef.current}\n              groups={groups}\n              user={user}\n              currentPdf={pdfState}\n            />\n          </div>\n        </div>\n\n        {/* Content Area: Video Grid vs PDF Main Stage */}\n        <div style={{ flex: 1, display: \"flex\", gap: \"20px\", overflow: \"hidden\" }}>\n\n          {/* Main Stage (PDF or Screen Share) */}\n          {/* Only show PDF if I am presenter OR if presentation is active */}\n          {(showPdf && pdfState && (pdfState.isPresenting || amIPresenter())) ? (\n            <div style={{\n              flex: 3,\n              display: \"flex\",\n              flexDirection: \"column\",\n              background: \"#2a2a2a\",\n              borderRadius: \"12px\",\n              overflow: \"hidden\"\n            }}>\n              {/* PDF Toolbar */}\n              <div style={{\n                padding: \"10px\",\n                background: \"rgba(0,0,0,0.3)\",\n                display: \"flex\",\n                justifyContent: \"space-between\",\n                alignItems: \"center\"\n              }}>\n                {/* Page Controls */}\n                <div style={{ display: \"flex\", gap: \"10px\", alignItems: \"center\" }}>\n                  <button\n                    onClick={() => changePdfPage(-1)}\n                    disabled={pdfState.currentPage <= 1 || !amIPresenter()}\n                    className=\"btn\"\n                    style={{ padding: \"5px 10px\", opacity: amIPresenter() ? 1 : 0.5 }}\n                  >\n                    â†\n                  </button>\n                  <span style={{ color: \"white\" }}>\n                    {pdfState.currentPage} / {pdfState.totalPages || \"--\"}\n                  </span>\n                  <button\n                    onClick={() => changePdfPage(1)}\n                    disabled={pdfState.currentPage >= pdfState.totalPages || !amIPresenter()}\n                    className=\"btn\"\n                    style={{ padding: \"5px 10px\", opacity: amIPresenter() ? 1 : 0.5 }}\n                  >\n                    â†’\n                  </button>\n                </div>\n\n                {/* Title */}\n                <div style={{ color: \"rgba(255,255,255,0.7)\", fontSize: \"0.9rem\" }}>\n                  {pdfState.filename && pdfState.filename.substring(0, 20)}...\n                  {!amIPresenter() && \" (Solo visualizaciÃ³n)\"}\n                  {amIPresenter() && \" (Presentador âœï¸)\"}\n                </div>\n\n                {/* Close / Actions */}\n                <div style={{ display: 'flex', gap: '10px' }}>\n                  {amIPresenter() && (\n                    <>\n                      {!pdfState.isPresenting ? (\n                        <button\n                          onClick={() => socketRef.current.emit(\"pdf-toggle-presentation\", { roomId, isPresenting: true })}\n                          style={{ background: \"#10b981\", border: \"none\", color: \"white\", padding: \"5px 10px\", borderRadius: \"4px\", cursor: \"pointer\" }}\n                        >\n                          â–¶ Presentar a Todos\n                        </button>\n                      ) : (\n                        <button\n                          onClick={() => socketRef.current.emit(\"pdf-toggle-presentation\", { roomId, isPresenting: false })}\n                          style={{ background: \"#f59e0b\", border: \"none\", color: \"white\", padding: \"5px 10px\", borderRadius: \"4px\", cursor: \"pointer\" }}\n                        >\n                          â¸ Pausar PresentaciÃ³n\n                        </button>\n                      )}\n                    </>\n                  )}\n\n                  {amIOwner() && (\n                    <button\n                      onClick={() => socketRef.current.emit(\"pdf-remove\", { roomId })}\n                      style={{ background: \"#ef4444\", border: \"none\", color: \"white\", padding: \"5px 10px\", borderRadius: \"4px\", cursor: \"pointer\" }}\n                    >\n                      Eliminar PDF\n                    </button>\n                  )}\n                </div>\n              </div>\n\n              {/* PDF Canvas */}\n              <div style={{ flex: 1, position: \"relative\", background: \"#525659\", overflow: \"hidden\" }}>\n                {/* We need containerWidth to scale PDF */}\n                <div style={{ position: \"relative\", width: \"100%\", height: \"100%\" }}>\n                  <PdfViewer\n                    fileUrl={`${API_URL}/pdf/file/${pdfState.filename}`}\n                    fileType={pdfState.filename.endsWith('.pdf') ? 'application/pdf' : 'image/jpeg'}\n                    pageNumber={pdfState.currentPage}\n                    onPageChange={(p) => {\n                      // Already handled by socket event usually, but local update too\n                    }}\n                    scale={1.0}\n                    onPageLoadSuccess={(pdf) => {\n                      if (onPdfLoadSuccess) onPdfLoadSuccess(pdf.numPages);\n                    }}\n                    // Pass ONLY lines for current page\n                    whiteboardLines={whiteboardData[pdfState.currentPage] || []}\n                    onDraw={handleWhiteboardDraw}\n                    canDraw={shouldShowControls}\n                    tool={activeTool}\n                  />\n                  {/* Eraser / Pen toggle could go here or in Toolbar */}\n                  {shouldShowControls && (\n                    <div style={{ position: 'absolute', top: 10, left: 10, display: 'flex', gap: 5 }}>\n                      <button onClick={() => setActiveTool(\"pen\")} style={{ background: activeTool === \"pen\" ? \"#3b82f6\" : \"white\" }}>âœï¸</button>\n                      <button onClick={() => setActiveTool(\"eraser\")} style={{ background: activeTool === \"eraser\" ? \"#ef4444\" : \"white\" }}>ðŸ§¹</button>\n                      <button onClick={handleClearWhiteboard} style={{ background: \"white\" }}>ðŸ—‘ï¸ Page</button>\n                    </div>\n                  )}\n                </div>\n              </div>\n            </div>\n          ) : null}\n\n          {/* Video Grid (Sidebar if PDF active, Main if not) */}\n          <div className=\"video-grid-container\" style={{\n            flex: (showPdf && pdfState && (pdfState.isPresenting || amIPresenter())) ? 1 : 1,\n            display: \"grid\",\n            gridTemplateColumns: (showPdf && pdfState && (pdfState.isPresenting || amIPresenter())) ? \"1fr\" : \"repeat(auto-fit, minmax(300px, 1fr))\",\n            gridAutoRows: \"minmax(200px, 1fr)\",\n            gap: \"15px\",\n            padding: \"10px\",\n            width: \"100%\",\n            overflowY: \"auto\",\n            alignContent: (showPdf && pdfState && (pdfState.isPresenting || amIPresenter())) ? \"start\" : \"center\",\n            maxHeight: (showPdf && pdfState && (pdfState.isPresenting || amIPresenter())) ? \"none\" : \"calc(100vh - 150px)\" // adjustments\n          }}>\n            {/* My video */}\n            <div style={{\n              position: \"relative\",\n              background: \"#1a1a1a\",\n              borderRadius: \"12px\",\n              overflow: \"hidden\",\n              border: isSpeaking ? \"3px solid #10b981\" : \"3px solid transparent\",\n              transition: \"all 0.3s ease\",\n              boxShadow: isSpeaking ? \"0 0 20px rgba(16, 185, 129, 0.5)\" : \"0 4px 6px rgba(0,0,0,0.3)\",\n              aspectRatio: \"16/9\",\n              minHeight: \"150px\"\n            }}>\n              <video\n                playsInline\n                muted\n                ref={myVideo}\n                autoPlay\n                style={{\n                  width: \"100%\",\n                  height: \"100%\",\n                  objectFit: \"cover\",\n                  transform: !screenStream ? \"scaleX(-1)\" : \"none\",\n                  display: videoEnabled || screenStream ? \"block\" : \"none\"\n                }}\n              />\n              {!videoEnabled && (\n                <div style={{\n                  width: \"100%\",\n                  height: \"100%\",\n                  display: \"flex\",\n                  alignItems: \"center\",\n                  justifyContent: \"center\",\n                  background: \"linear-gradient(135deg, #667eea 0%, #764ba2 100%)\"\n                }}>\n                  <div style={{\n                    width: \"50px\",\n                    height: \"50px\",\n                    borderRadius: \"50%\",\n                    background: \"rgba(255,255,255,0.2)\",\n                    display: \"flex\",\n                    alignItems: \"center\",\n                    justifyContent: \"center\",\n                    fontSize: \"1.5rem\",\n                    color: \"white\",\n                    fontWeight: \"bold\"\n                  }}>\n                    {user?.nombre?.charAt(0).toUpperCase()}\n                  </div>\n                </div>\n              )}\n              <div style={{\n                position: \"absolute\",\n                bottom: \"10px\",\n                left: \"10px\",\n                background: \"rgba(0,0,0,0.8)\",\n                padding: \"4px 8px\",\n                borderRadius: \"6px\",\n                color: \"white\",\n                fontSize: \"0.8rem\",\n                fontWeight: \"500\"\n              }}>\n                {user?.nombre} (TÃº)\n              </div>\n            </div>\n\n            {/* Peer videos */}\n            {peers.map(({ peerID, peer }) => {\n              const participant = participants.find(p => p.socketId === peerID);\n              const name = participant ? participant.nombre : \"Usuario\";\n              return (\n                <VideoCard\n                  key={peerID}\n                  peer={peer}\n                  peerID={peerID}\n                  userName={name}\n                  isActive={activeSpeakers.has(peerID)}\n                />\n              );\n            })}\n          </div>\n\n        </div>\n\n        {/* Control bar */}\n        <div style={{\n          display: \"flex\",\n          justifyContent: \"center\",\n          gap: \"15px\",\n          padding: \"15px\",\n          background: \"rgba(255,255,255,0.05)\",\n          borderRadius: \"12px\"\n        }}>\n          <button\n            onClick={toggleAudio}\n            style={{\n              padding: \"12px 20px\",\n              borderRadius: \"8px\",\n              border: \"none\",\n              background: audioEnabled ? \"var(--accent-primary)\" : \"#ef4444\",\n              color: \"white\",\n              cursor: \"pointer\",\n              fontSize: \"1rem\",\n              fontWeight: \"500\"\n            }}\n          >\n            {audioEnabled ? \"ðŸŽ¤ MicrÃ³fono\" : \"ðŸ”‡ Mutear\"}\n          </button>\n          <button\n            onClick={toggleVideo}\n            style={{\n              padding: \"12px 20px\",\n              borderRadius: \"8px\",\n              border: \"none\",\n              background: videoEnabled ? \"var(--accent-primary)\" : \"#ef4444\",\n              color: \"white\",\n              cursor: \"pointer\",\n              fontSize: \"1rem\",\n              fontWeight: \"500\"\n            }}\n          >\n            {videoEnabled ? \"ðŸ“¹ CÃ¡mara\" : \"ðŸ“· Sin Video\"}\n          </button>\n          <button\n            onClick={screenStream ? stopScreenShare : shareScreen}\n            style={{\n              padding: \"12px 20px\",\n              borderRadius: \"8px\",\n              border: \"none\",\n              background: screenStream ? \"#ef4444\" : \"var(--accent-secondary)\",\n              color: \"white\",\n              cursor: \"pointer\",\n              fontSize: \"1rem\",\n              fontWeight: \"500\"\n            }}\n          >\n            {screenStream ? \"â¹ï¸ Detener\" : \"ðŸ–¥ï¸ Compartir Pantalla\"}\n          </button>\n\n          {/* Upload/Delete PDF Button */}\n          {pdfState ? (\n            amIOwner() && (\n              <button\n                onClick={() => socketRef.current.emit(\"pdf-remove\", { roomId })}\n                style={{\n                  padding: \"12px 20px\",\n                  borderRadius: \"8px\",\n                  border: \"none\",\n                  background: \"#ef4444\",\n                  color: \"white\",\n                  cursor: \"pointer\",\n                  fontSize: \"1rem\",\n                  fontWeight: \"500\"\n                }}\n              >\n                ðŸ—‘ï¸ Eliminar PDF\n              </button>\n            )\n          ) : (\n            <>\n              <button\n                onClick={() => fileInputRef.current?.click()}\n                disabled={uploadingPdf}\n                style={{\n                  padding: \"12px 20px\",\n                  borderRadius: \"8px\",\n                  border: \"none\",\n                  background: \"#8b5cf6\",\n                  color: \"white\",\n                  cursor: uploadingPdf ? \"not-allowed\" : \"pointer\",\n                  fontSize: \"1rem\",\n                  fontWeight: \"500\"\n                }}\n              >\n                {uploadingPdf ? \"Subiendo...\" : \"ðŸ“„ Subir PDF\"}\n              </button>\n              <input\n                ref={fileInputRef}\n                type=\"file\"\n                accept=\"application/pdf\"\n                onChange={handlePdfUpload}\n                style={{ display: \"none\" }}\n              />\n            </>\n          )}\n          <button\n            onClick={leaveRoom}\n            style={{\n              padding: \"12px 20px\",\n              borderRadius: \"8px\",\n              border: \"none\",\n              background: \"#dc2626\",\n              color: \"white\",\n              cursor: \"pointer\",\n              fontSize: \"1rem\",\n              fontWeight: \"500\"\n            }}\n          >\n            ðŸšª Salir\n          </button>\n        </div>\n      </div>\n\n      {/* Chat panel */}\n      {showChat && (\n        <div style={{\n          width: \"350px\",\n          background: \"rgba(30, 30, 40, 0.95)\",\n          borderLeft: \"1px solid rgba(255,255,255,0.1)\",\n          display: \"flex\",\n          flexDirection: \"column\",\n          boxShadow: \"-4px 0 10px rgba(0,0,0,0.3)\"\n        }}>\n          {/* Participants List - NEW FEATURE */}\n          <div style={{\n            padding: \"15px\",\n            borderBottom: \"1px solid rgba(255,255,255,0.1)\",\n            background: \"rgba(0,0,0,0.2)\"\n          }}>\n            <h3 style={{ margin: 0, fontSize: \"1rem\", color: \"var(--accent-secondary)\" }}>\n              ðŸ‘¥ Participantes ({participants.length})\n            </h3>\n            <div style={{ maxHeight: \"100px\", overflowY: \"auto\", marginTop: \"10px\" }}>\n              {participants.map(p => {\n                // Check if presenter\n                const isPresenter = pdfState?.presenters?.includes(p.userId);\n                const canManage = amIOwner() && p.userId !== user.id;\n\n                return (\n                  <div key={p.socketId || p.userId} style={{ fontSize: \"0.85rem\", color: \"#ccc\", padding: \"2px 0\", display: \"flex\", justifyContent: \"space-between\", alignItems: \"center\" }}>\n                    <span>\n                      â€¢ {p.nombre} {p.socketId === socketRef.current?.id ? \"(TÃº)\" : \"\"}\n                      {isPresenter && \" âœï¸\"}\n                    </span>\n                    {canManage && (\n                      <button\n                        onClick={() => isPresenter ? revokePresenter(p.userId) : grantPresenter(p.userId)}\n                        style={{ fontSize: \"0.7rem\", padding: \"1px 5px\", cursor: \"pointer\", background: \"none\", border: \"1px solid #666\", color: \"#aaa\", borderRadius: \"3px\" }}\n                      >\n                        {isPresenter ? \"Quitar Rol\" : \"Hacer Presentador\"}\n                      </button>\n                    )}\n                  </div>\n                );\n              })}\n            </div>\n          </div>\n\n          <div style={{\n            padding: \"20px\",\n            borderBottom: \"1px solid rgba(255,255,255,0.1)\",\n            background: \"rgba(0,0,0,0.2)\"\n          }}>\n            <h3 style={{\n              margin: 0,\n              color: \"var(--text-primary)\",\n              fontSize: \"1.1rem\",\n              fontWeight: \"600\"\n            }}>\n              ðŸ’¬ Chat\n            </h3>\n            <p style={{\n              margin: \"5px 0 0 0\",\n              fontSize: \"0.75rem\",\n              color: \"var(--text-secondary)\"\n            }}>\n              {messages.length} mensaje{messages.length !== 1 ? 's' : ''}\n            </p>\n          </div>\n          <div style={{\n            flex: 1,\n            overflowY: \"auto\",\n            padding: \"15px\",\n            display: \"flex\",\n            flexDirection: \"column\",\n            gap: \"12px\"\n          }}>\n            {messages.length === 0 ? (\n              <div style={{\n                textAlign: \"center\",\n                color: \"var(--text-secondary)\",\n                padding: \"40px 20px\",\n                fontSize: \"0.9rem\"\n              }}>\n                <div style={{ fontSize: \"2rem\", marginBottom: \"10px\" }}>ðŸ’¬</div>\n                No hay mensajes aÃºn.<br />\n                Â¡SÃ© el primero en escribir!\n              </div>\n            ) : (\n              messages.map((msg, idx) => {\n                const myId = user.id || user._id; // Robust ID\n                const isMe = msg.userId === myId;\n                const time = new Date(msg.timestamp).toLocaleTimeString('es-ES', {\n                  hour: '2-digit',\n                  minute: '2-digit'\n                });\n\n                return (\n                  <div key={idx} style={{\n                    display: \"flex\",\n                    flexDirection: \"column\",\n                    alignItems: isMe ? \"flex-end\" : \"flex-start\",\n                    animation: \"fadeIn 0.3s ease\"\n                  }}>\n                    {!isMe && (\n                      <div style={{\n                        fontSize: \"0.75rem\",\n                        color: \"var(--accent-primary)\",\n                        marginBottom: \"3px\",\n                        fontWeight: \"600\"\n                      }}>\n                        {msg.userName}\n                      </div>\n                    )}\n                    <div style={{\n                      background: isMe\n                        ? \"linear-gradient(135deg, #667eea 0%, #764ba2 100%)\"\n                        : \"rgba(255,255,255,0.08)\",\n                      padding: \"10px 14px\",\n                      borderRadius: isMe ? \"12px 12px 4px 12px\" : \"12px 12px 12px 4px\",\n                      maxWidth: \"80%\",\n                      wordWrap: \"break-word\",\n                      boxShadow: \"0 2px 4px rgba(0,0,0,0.2)\"\n                    }}>\n                      <div style={{\n                        color: \"var(--text-primary)\",\n                        fontSize: \"0.95rem\",\n                        lineHeight: \"1.4\"\n                      }}>\n                        {msg.texto}\n                      </div>\n                      <div style={{\n                        fontSize: \"0.7rem\",\n                        color: isMe ? \"rgba(255,255,255,0.7)\" : \"var(--text-secondary)\",\n                        marginTop: \"4px\",\n                        textAlign: \"right\"\n                      }}>\n                        {time}\n                      </div>\n                    </div>\n                  </div>\n                );\n              })\n            )}\n            <div ref={chatEndRef} />\n          </div>\n          <form onSubmit={sendMessage} style={{\n            padding: \"15px\",\n            borderTop: \"1px solid rgba(255,255,255,0.1)\",\n            display: \"flex\",\n            gap: \"10px\",\n            background: \"rgba(0,0,0,0.2)\"\n          }}>\n            <input\n              type=\"text\"\n              value={newMessage}\n              onChange={(e) => setNewMessage(e.target.value)}\n              placeholder=\"Escribe un mensaje...\"\n              style={{\n                flex: 1,\n                padding: \"12px\",\n                borderRadius: \"8px\",\n                border: \"1px solid rgba(255,255,255,0.1)\",\n                background: \"rgba(255,255,255,0.05)\",\n                color: \"var(--text-primary)\",\n                fontSize: \"0.95rem\",\n                outline: \"none\",\n                transition: \"all 0.2s\"\n              }}\n              onFocus={(e) => e.target.style.borderColor = \"var(--accent-primary)\"}\n              onBlur={(e) => e.target.style.borderColor = \"rgba(255,255,255,0.1)\"}\n            />\n            <button\n              type=\"submit\"\n              className=\"btn\"\n              style={{\n                padding: \"12px 20px\",\n                minWidth: \"70px\",\n                fontSize: \"0.9rem\"\n              }}\n              disabled={!newMessage.trim()}\n            >\n              Enviar\n            </button>\n          </form>\n        </div>\n      )}\n\n\n    </div>\n  );\n}\n\nfunction VideoCard({ peer, peerID, isActive, userName }) {\n  const ref = useRef();\n  const [hasVideo, setHasVideo] = useState(true);\n  const [status, setStatus] = useState(\"Conectando...\");\n  const [debugInfo, setDebugInfo] = useState(\"\");\n\n  useEffect(() => {\n    // 1. Define event handler\n    const handleStream = (stream) => {\n      console.log(`VideoCard: Stream received for ${peerID}`, stream.getTracks());\n      if (ref.current) {\n        ref.current.srcObject = stream;\n        const videoTracks = stream.getVideoTracks();\n        setHasVideo(videoTracks.length > 0 && videoTracks[0].enabled);\n        setStatus(\"Conectado ðŸŸ¢\");\n      }\n    };\n\n    // 2. Listen for event\n    peer.on(\"stream\", handleStream);\n\n    // 3. CRITICAL: Check if stream already exists (missed event)\n    if (peer._remoteStreams && peer._remoteStreams.length > 0) {\n      console.log(`VideoCard: Found existing stream for ${peerID}`);\n      handleStream(peer._remoteStreams[0]);\n    }\n\n    peer.on(\"connect\", () => {\n      console.log(`VideoCard: Peer ${peerID} connected`);\n      setStatus(\"Negociando medios... ðŸŸ¡\");\n    });\n\n    peer.on(\"error\", (err) => {\n      console.error(`VideoCard: Peer error for ${peerID}:`, err);\n      setStatus(`Error: ${err.code || err.message} ðŸ”´`);\n      setDebugInfo(err.toString());\n    });\n\n    peer.on(\"close\", () => {\n      setStatus(\"Desconectado âš«\");\n    });\n\n    // Handle track mute/unmute events\n    peer.on(\"track\", (track, stream) => {\n      track.onmute = () => {\n        if (track.kind === 'video') setHasVideo(false);\n      };\n      track.onunmute = () => {\n        if (track.kind === 'video') setHasVideo(true);\n      };\n    });\n\n  }, [peer, peerID]);\n\n  return (\n    <div style={{\n      position: \"relative\",\n      background: \"#1a1a1a\",\n      borderRadius: \"12px\",\n      overflow: \"hidden\",\n      border: isActive ? \"3px solid #10b981\" : \"3px solid transparent\",\n      transition: \"all 0.3s ease\",\n      boxShadow: isActive ? \"0 0 20px rgba(16, 185, 129, 0.5)\" : \"0 4px 6px rgba(0,0,0,0.3)\",\n      aspectRatio: \"16/9\",\n      minHeight: \"200px\"\n    }}>\n      <video\n        playsInline\n        autoPlay\n        ref={ref}\n        id={`video-${peerID}`}\n        style={{\n          width: \"100%\",\n          height: \"100%\",\n          objectFit: \"cover\",\n          display: hasVideo ? \"block\" : \"none\",\n          backgroundColor: \"#000\" // Ensure black background if loading\n        }}\n      />\n\n      {/* Overlay for status when video is active but maybe black */}\n      <div style={{\n        position: \"absolute\",\n        top: \"5px\",\n        left: \"5px\",\n        zIndex: 10,\n        background: \"rgba(0,0,0,0.6)\",\n        padding: \"2px 6px\",\n        borderRadius: \"4px\",\n        fontSize: \"0.7rem\",\n        color: status.includes(\"Error\") ? \"#ff4444\" : \"#ffffff\",\n        pointerEvents: \"none\"\n      }}>\n        {status}\n      </div>\n\n      {!hasVideo && (\n        <div style={{\n          width: \"100%\",\n          height: \"100%\",\n          display: \"flex\",\n          flexDirection: \"column\",\n          alignItems: \"center\",\n          justifyContent: \"center\",\n          background: \"linear-gradient(135deg, #f093fb 0%, #f5576c 100%)\",\n          position: \"absolute\",\n          top: 0,\n          left: 0\n        }}>\n          <div style={{\n            width: \"80px\",\n            height: \"80px\",\n            borderRadius: \"50%\",\n            background: \"rgba(255,255,255,0.2)\",\n            display: \"flex\",\n            alignItems: \"center\",\n            justifyContent: \"center\",\n            fontSize: \"2rem\",\n            color: \"white\",\n            fontWeight: \"bold\",\n            marginBottom: \"10px\"\n          }}>\n            ðŸ‘¤\n          </div>\n          <div style={{ color: \"white\", fontSize: \"0.8rem\" }}>CÃ¡mara apagada</div>\n        </div>\n      )}\n\n      {/* Debug Info Overlay (if error) */}\n      {debugInfo && (\n        <div style={{\n          position: \"absolute\",\n          bottom: \"40px\",\n          left: \"0\",\n          right: \"0\",\n          background: \"rgba(255,0,0,0.8)\",\n          color: \"white\",\n          fontSize: \"0.7rem\",\n          padding: \"5px\",\n          wordBreak: \"break-all\"\n        }}>\n          {debugInfo}\n        </div>\n      )}\n\n      <div style={{\n        position: \"absolute\",\n        bottom: \"10px\",\n        left: \"10px\",\n        background: \"rgba(0,0,0,0.8)\",\n        padding: \"6px 12px\",\n        borderRadius: \"6px\",\n        color: \"white\",\n        fontSize: \"0.9rem\",\n        fontWeight: \"500\"\n      }}>\n        {userName || \"Participante\"}\n      </div>\n      {isActive && (\n        <div style={{\n          position: \"absolute\",\n          top: \"10px\",\n          right: \"10px\",\n          background: \"rgba(16, 185, 129, 0.9)\",\n          padding: \"4px 8px\",\n          borderRadius: \"4px\",\n          color: \"white\",\n          fontSize: \"0.75rem\",\n          fontWeight: \"600\"\n        }}>\n          ðŸŽ¤ Hablando\n        </div>\n      )}\n    </div>\n  );\n}\n\nexport default Room;\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}